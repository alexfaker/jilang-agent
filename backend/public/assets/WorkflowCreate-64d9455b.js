import{_ as U,C as W,D as j,g as b,q as $,H as D,c as i,a as t,x as E,y as n,z as m,n as c,t as u,j as l,A as x,d as w,e as T,o as d}from"./index-f19ebc4a.js";import{u as z}from"./workflow-efdfe936.js";const B={class:"py-6"},I={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},M={class:"flex items-center justify-between"},A={class:"mt-6 bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg"},H={class:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6"},q={class:"sm:col-span-4"},F={class:"mt-1"},P={key:0,class:"mt-2 text-sm text-red-600"},R={class:"sm:col-span-6"},G={class:"mt-1"},K={key:0,class:"mt-2 text-sm text-red-600"},L={class:"sm:col-span-3"},Q={class:"mt-1"},X={key:0,class:"mt-2 text-sm text-red-600"},Y={key:0,class:"sm:col-span-3"},Z={class:"mt-1"},ee={key:0,class:"mt-2 text-sm text-red-600"},te={key:1,class:"sm:col-span-3"},re={class:"mt-1"},oe={key:2,class:"sm:col-span-3"},se={class:"mt-1"},ae={key:0,class:"mt-2 text-sm text-red-600"},ie={class:"sm:col-span-3"},de={class:"mt-1"},ne={class:"sm:col-span-3"},le={class:"mt-1"},ge={class:"sm:col-span-3"},me={class:"mt-1"},ue={class:"sm:col-span-6 border-t border-gray-200 dark:border-gray-700 pt-5 mt-4"},ce={class:"mt-4"},pe={class:"mt-1"},ye={key:0,class:"mt-2 text-sm text-red-600"},fe={class:"pt-5 mt-6 border-t border-gray-200 dark:border-gray-700"},be={class:"flex justify-end"},xe=["disabled"],ve={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ke={__name:"WorkflowCreate",setup(_e){const h=W(),f=j(),S=z(),p=b(!1),s=b({}),g=b(`{
  "steps": []
}`),r=$({name:"",description:"",trigger_type:"",trigger_config:{},status:"draft",timeout:300,max_retries:3,tasks:[]});D(g,o=>{try{const e=JSON.parse(o);e&&e.steps&&(r.tasks=e.steps)}catch{}});const N=()=>{r.trigger_config={},r.trigger_type==="schedule"?r.trigger_config.cron="0 0 * * *":r.trigger_type==="webhook"?r.trigger_config.secret="":r.trigger_type==="event"&&(r.trigger_config.event_type="")},C=()=>{try{const o=JSON.parse(g.value);g.value=JSON.stringify(o,null,2),s.value.definition=""}catch(o){s.value.definition=`JSON格式错误: ${o.message}`}},V=()=>{const o={};r.name.trim()||(o.name="工作流名称不能为空"),r.description.trim()||(o.description="工作流描述不能为空"),r.trigger_type?(r.trigger_type==="schedule"&&!r.trigger_config.cron&&(o.trigger_config||(o.trigger_config={}),o.trigger_config.cron="请设置计划表达式"),r.trigger_type==="event"&&!r.trigger_config.event_type&&(o.trigger_config||(o.trigger_config={}),o.trigger_config.event_type="请选择事件类型")):o.trigger_type="请选择触发器类型";try{JSON.parse(g.value)}catch(e){o.definition=`JSON格式错误: ${e.message}`}return s.value=o,Object.keys(o).length===0},O=()=>{let o;try{o=JSON.parse(g.value)}catch(e){throw new Error(`JSON格式错误: ${e.message}`)}return{name:r.name,description:r.description,status:r.status,trigger_type:r.trigger_type,trigger_config:r.trigger_config,timeout:parseInt(r.timeout)||0,max_retries:parseInt(r.max_retries)||0,definition:o}},J=async()=>{if(!V()){f.error("请修正表单中的错误");return}p.value=!0;try{const o=O();await S.createWorkflow(o),f.success("工作流创建成功"),h.push("/workflows")}catch(o){if(console.error("创建工作流失败",o),o.response&&o.response.status===400){const e=o.response.data.errors||{};Object.keys(e).forEach(y=>{s.value[y]=e[y]}),f.error("表单验证失败，请检查输入")}else f.error("创建工作流失败: "+(o.message||"未知错误"))}finally{p.value=!1}};return(o,e)=>{var y,v,k,_;return d(),i("div",B,[t("div",I,[t("div",M,[e[12]||(e[12]=t("h1",{class:"text-2xl font-semibold text-gray-900 dark:text-white"},"创建工作流",-1)),t("button",{onClick:e[0]||(e[0]=a=>o.$router.back()),class:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 返回 ")]),t("div",A,[t("form",{onSubmit:E(J,["prevent"]),class:"p-6"},[t("div",H,[t("div",q,[e[13]||(e[13]=t("label",{for:"name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 工作流名称 ",-1)),t("div",F,[n(t("input",{type:"text",id:"name","onUpdate:modelValue":e[1]||(e[1]=a=>r.name=a),class:c([{"border-red-300 focus:ring-red-500 focus:border-red-500":s.value.name},"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"]),placeholder:"输入工作流名称"},null,2),[[m,r.name]]),s.value.name?(d(),i("p",P,u(s.value.name),1)):l("",!0)])]),t("div",R,[e[14]||(e[14]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 描述 ",-1)),t("div",G,[n(t("textarea",{id:"description","onUpdate:modelValue":e[2]||(e[2]=a=>r.description=a),rows:"3",class:c([{"border-red-300 focus:ring-red-500 focus:border-red-500":s.value.description},"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"]),placeholder:"描述此工作流的用途和功能"},null,2),[[m,r.description]]),s.value.description?(d(),i("p",K,u(s.value.description),1)):l("",!0)]),e[15]||(e[15]=t("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"简要描述此工作流的目的和功能",-1))]),t("div",L,[e[17]||(e[17]=t("label",{for:"trigger_type",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 触发器类型 ",-1)),t("div",Q,[n(t("select",{id:"trigger_type","onUpdate:modelValue":e[3]||(e[3]=a=>r.trigger_type=a),class:c([{"border-red-300 focus:ring-red-500 focus:border-red-500":s.value.trigger_type},"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"]),onChange:N},e[16]||(e[16]=[w('<option value="" data-v-b5e25bd5>选择触发器类型</option><option value="schedule" data-v-b5e25bd5>定时计划</option><option value="webhook" data-v-b5e25bd5>Webhook</option><option value="manual" data-v-b5e25bd5>手动触发</option><option value="event" data-v-b5e25bd5>事件触发</option>',5)]),34),[[x,r.trigger_type]]),s.value.trigger_type?(d(),i("p",X,u(s.value.trigger_type),1)):l("",!0)])]),r.trigger_type==="schedule"?(d(),i("div",Y,[e[18]||(e[18]=t("label",{for:"schedule",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 计划表达式 (Cron) ",-1)),t("div",Z,[n(t("input",{type:"text",id:"schedule","onUpdate:modelValue":e[4]||(e[4]=a=>r.trigger_config.cron=a),class:c([{"border-red-300 focus:ring-red-500 focus:border-red-500":(y=s.value.trigger_config)==null?void 0:y.cron},"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"]),placeholder:"例如: 0 0 * * * (每天零点)"},null,2),[[m,r.trigger_config.cron]]),(v=s.value.trigger_config)!=null&&v.cron?(d(),i("p",ee,u(s.value.trigger_config.cron),1)):l("",!0)]),e[19]||(e[19]=t("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"使用 cron 表达式设置定时计划",-1))])):l("",!0),r.trigger_type==="webhook"?(d(),i("div",te,[e[20]||(e[20]=t("label",{for:"webhook_secret",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," Webhook 密钥 (可选) ",-1)),t("div",re,[n(t("input",{type:"text",id:"webhook_secret","onUpdate:modelValue":e[5]||(e[5]=a=>r.trigger_config.secret=a),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md",placeholder:"webhook 安全密钥"},null,512),[[m,r.trigger_config.secret]])]),e[21]||(e[21]=t("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"用于验证 webhook 请求的密钥",-1))])):l("",!0),r.trigger_type==="event"?(d(),i("div",oe,[e[23]||(e[23]=t("label",{for:"event_type",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 事件类型 ",-1)),t("div",se,[n(t("select",{id:"event_type","onUpdate:modelValue":e[6]||(e[6]=a=>r.trigger_config.event_type=a),class:c([{"border-red-300 focus:ring-red-500 focus:border-red-500":(k=s.value.trigger_config)==null?void 0:k.event_type},"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"])},e[22]||(e[22]=[w('<option value="" data-v-b5e25bd5>选择事件类型</option><option value="file_upload" data-v-b5e25bd5>文件上传</option><option value="database_change" data-v-b5e25bd5>数据库变更</option><option value="api_call" data-v-b5e25bd5>API 调用</option><option value="system_event" data-v-b5e25bd5>系统事件</option>',5)]),2),[[x,r.trigger_config.event_type]]),(_=s.value.trigger_config)!=null&&_.event_type?(d(),i("p",ae,u(s.value.trigger_config.event_type),1)):l("",!0)])])):l("",!0),t("div",ie,[e[25]||(e[25]=t("label",{for:"status",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 状态 ",-1)),t("div",de,[n(t("select",{id:"status","onUpdate:modelValue":e[7]||(e[7]=a=>r.status=a),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"},e[24]||(e[24]=[t("option",{value:"draft"},"草稿",-1),t("option",{value:"active"},"活跃",-1),t("option",{value:"inactive"},"暂停",-1)]),512),[[x,r.status]])])]),t("div",ne,[e[26]||(e[26]=t("label",{for:"timeout",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 执行超时（秒） ",-1)),t("div",le,[n(t("input",{type:"number",id:"timeout","onUpdate:modelValue":e[8]||(e[8]=a=>r.timeout=a),min:"0",class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md",placeholder:"工作流执行超时时间（秒）"},null,512),[[m,r.timeout]])]),e[27]||(e[27]=t("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"},"0 表示无超时限制",-1))]),t("div",ge,[e[28]||(e[28]=t("label",{for:"max_retries",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 最大重试次数 ",-1)),t("div",me,[n(t("input",{type:"number",id:"max_retries","onUpdate:modelValue":e[9]||(e[9]=a=>r.max_retries=a),min:"0",class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md",placeholder:"失败时重试次数"},null,512),[[m,r.max_retries]])])]),t("div",ue,[e[30]||(e[30]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900 dark:text-white"},"工作流定义",-1)),e[31]||(e[31]=t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"使用JSON格式定义工作流的步骤和逻辑",-1)),t("div",ce,[e[29]||(e[29]=t("label",{for:"definition",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," JSON 定义 ",-1)),t("div",pe,[n(t("textarea",{id:"definition","onUpdate:modelValue":e[10]||(e[10]=a=>g.value=a),rows:"10",class:c([{"border-red-300 focus:ring-red-500 focus:border-red-500":s.value.definition},"font-mono shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"]),placeholder:'{"steps": []}'},null,2),[[m,g.value]]),s.value.definition?(d(),i("p",ye,u(s.value.definition),1)):l("",!0)])]),t("div",{class:"mt-4 flex justify-end"},[t("button",{type:"button",onClick:C,class:"inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 格式化 JSON ")])])]),t("div",fe,[t("div",be,[t("button",{type:"button",onClick:e[11]||(e[11]=a=>o.$router.back()),class:"bg-white dark:bg-gray-800 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 取消 "),t("button",{type:"submit",disabled:p.value,class:"ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},[p.value?(d(),i("svg",ve,e[32]||(e[32]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):l("",!0),T(" "+u(p.value?"保存中...":"保存工作流"),1)],8,xe)])])],32)])])])}}},Se=U(ke,[["__scopeId","data-v-b5e25bd5"]]);export{Se as default};
