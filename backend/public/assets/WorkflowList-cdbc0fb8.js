import{o as a,c as g,a as t,_ as ee,C as te,D as se,g as d,v as re,h as oe,E as ne,n as f,y as ae,A as le,F as ie,i as ce,b as n,w as E,u as i,j as C,t as p,e as $,m as h,r as de,l as M,G as ue}from"./index-f19ebc4a.js";import{r as ge}from"./ClockIcon-cbcc2b6e.js";import{r as me,a as O}from"./PlusIcon-58fe7323.js";import{r as A}from"./ArrowPathIcon-48974b59.js";import{r as ve}from"./RectangleStackIcon-31e18f18.js";import{r as fe}from"./ExclamationTriangleIcon-acab16c9.js";import{r as S}from"./CpuChipIcon-576f530e.js";import{r as pe}from"./MagnifyingGlassIcon-e9ac7f42.js";import{a as xe,r as he}from"./DocumentTextIcon-9f863586.js";function be(B,W){return a(),g("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z"})])}function ye(B,W){return a(),g("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"})])}const we={class:"flex-1 overflow-y-auto p-6"},_e={class:"bg-white rounded-lg p-4 mb-6 flex flex-wrap items-center justify-between gap-4 shadow-sm"},ke={class:"flex flex-wrap gap-2"},Ce={class:"flex items-center"},$e={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},We={class:"p-6"},De={class:"flex items-center justify-between mb-4"},je={class:"flex items-center"},Ee={class:"text-lg font-semibold text-gray-800"},Me={class:"flex items-center mt-1"},Ae={class:"text-xs text-gray-500 ml-2"},Be={class:"dropdown relative"},Le=["onClick"],Fe={key:0,class:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 border border-gray-200"},Ve={class:"py-1"},Ze=["onClick"],Ne=["onClick"],Oe=["onClick"],Se=["onClick"],Te={class:"text-gray-600 text-sm mb-4 line-clamp-2"},Pe={class:"flex items-center justify-between mb-4"},ze={class:"flex items-center"},Ie={class:"text-xs text-gray-500"},Re={class:"flex items-center"},Ue={class:"text-xs text-gray-500"},Ge={class:"border-t pt-4 flex justify-between"},qe=["onClick","disabled"],He={class:"p-6 h-full flex flex-col items-center justify-center text-center"},Je={class:"w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center mb-4"},Ke={key:0,class:"text-center py-12"},Qe={class:"w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center"},Xe={key:1,class:"text-center py-12"},Ye={class:"w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center"},et={class:"text-gray-600 mb-6"},tt={key:2,class:"text-center py-12"},st={__name:"WorkflowList",setup(B){const W=te(),u=se(),b=d(!0),y=d(null),m=d("all"),D=d("newest"),c=d(null),x=d([]),w=d([]),L=d(0),F=d(1),V=d(20),v=async()=>{b.value=!0,y.value=null;try{const s={limit:V.value,offset:(F.value-1)*V.value};m.value!=="all"&&(s.status=m.value);const e=await h.getWorkflows(s);if(e.status==="success")w.value=e.data.workflows||[],L.value=e.data.pagination.total||0;else throw new Error(e.message||"获取工作流列表失败")}catch(s){console.error("获取工作流列表失败:",s),y.value="加载工作流失败："+(s.message||"未知错误"),w.value=[],L.value=0,u.error("加载工作流失败："+(s.message||"未知错误"))}finally{b.value=!1}},T=re(()=>{let s=w.value;switch(D.value){case"newest":s=s.sort((e,o)=>new Date(o.createdAt||o.created_at)-new Date(e.createdAt||e.created_at));break;case"name":s=s.sort((e,o)=>e.name.localeCompare(o.name));break;case"last_run":s=s.sort((e,o)=>new Date(o.updatedAt||o.updated_at)-new Date(e.updatedAt||e.updated_at));break;case"most_run":s=s.sort((e,o)=>(o.runCount||o.execution_count||0)-(e.runCount||e.execution_count||0));break}return s}),_=async s=>{m.value=s,F.value=1,await v()},P=()=>{},z=s=>{const e=new Date(s),r=new Date-e,l=Math.floor(r/(1e3*60)),N=Math.floor(r/(1e3*60*60)),k=Math.floor(r/(1e3*60*60*24));return l<60?`${l}分钟前`:N<24?`${N}小时前`:k===1?"昨天":k<7?`${k}天前`:`${Math.floor(k/7)}周前`},j=s=>{const e=s.name.toLowerCase(),o=(s.description||"").toLowerCase(),r=e+" "+o;return r.includes("数据")||r.includes("分析")||r.includes("统计")?"data":r.includes("客服")||r.includes("支持")||r.includes("回复")?"support":r.includes("内容")||r.includes("审核")||r.includes("文本")?"content":r.includes("分析")||r.includes("市场")||r.includes("投资")?"analysis":"data"},I=s=>{switch(s){case"data":return S;case"support":return he;case"content":return xe;case"analysis":return pe;default:return S}},R=s=>{switch(s){case"data":return"bg-blue-100";case"support":return"bg-purple-100";case"content":return"bg-green-100";case"analysis":return"bg-amber-100";default:return"bg-gray-100"}},U=s=>{switch(s){case"data":return"text-blue-600";case"support":return"text-purple-600";case"content":return"text-green-600";case"analysis":return"text-amber-600";default:return"text-gray-600"}},G=s=>{const e="badge";switch(s){case"active":return`${e} badge-active`;case"inactive":return`${e} badge-inactive`;case"draft":return`${e} badge-draft`;case"archived":return`${e} badge-archived`;default:return`${e} badge-draft`}},q=s=>{switch(s){case"active":return"活跃";case"inactive":return"暂停";case"draft":return"草稿";case"archived":return"已归档";default:return"未知"}},H=s=>{c.value=c.value===s?null:s},J=async s=>{if(!x.value.includes(s)){x.value.push(s);try{const e=await h.executeWorkflow(s,{});if(e.status==="success")u.success("工作流执行成功"),await v();else throw new Error(e.message||"执行失败")}catch(e){console.error("执行工作流失败:",e),u.error("工作流执行失败："+(e.message||"未知错误"))}finally{x.value=x.value.filter(e=>e!==s),c.value=null}}},K=s=>{W.push(`/workflows/edit/${s}`),c.value=null},Q=async s=>{try{const e=await h.getWorkflow(s);if(e.status!=="success")throw new Error("获取原始工作流失败");const o=e.data,r={name:`${o.name} (副本)`,description:o.description,definition:o.definition,status:"draft"},l=await h.createWorkflow(r);if(l.status==="success")u.success("工作流复制成功"),await v();else throw new Error(l.message||"复制失败")}catch(e){console.error("复制工作流失败:",e),u.error("工作流复制失败："+(e.message||"未知错误"))}finally{c.value=null}},X=async s=>{try{const e=await h.updateWorkflow(s,{status:"archived"});if(e.status==="success")u.success("工作流已归档"),await v();else throw new Error(e.message||"归档失败")}catch(e){console.error("归档工作流失败:",e),u.error("工作流归档失败："+(e.message||"未知错误"))}finally{c.value=null}},Y=async s=>{if(!confirm("确定要删除这个工作流吗？此操作不可撤销。")){c.value=null;return}try{const e=await h.deleteWorkflow(s);if(e.status==="success")u.success("工作流已删除"),await v();else throw new Error(e.message||"删除失败")}catch(e){console.error("删除工作流失败:",e),u.error("工作流删除失败："+(e.message||"未知错误"))}finally{c.value=null}},Z=s=>{s.target.closest(".dropdown")||(c.value=null)};return oe(async()=>{document.addEventListener("click",Z),await v()}),ne(()=>{document.removeEventListener("click",Z)}),(s,e)=>{const o=de("router-link");return a(),g("div",we,[t("div",_e,[t("div",ke,[t("button",{onClick:e[0]||(e[0]=r=>_("all")),class:f(["px-4 py-2 rounded-lg font-medium transition-colors",m.value==="all"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"])}," 全部工作流 ",2),t("button",{onClick:e[1]||(e[1]=r=>_("active")),class:f(["px-4 py-2 rounded-lg font-medium transition-colors",m.value==="active"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"])}," 活跃的 ",2),t("button",{onClick:e[2]||(e[2]=r=>_("draft")),class:f(["px-4 py-2 rounded-lg font-medium transition-colors",m.value==="draft"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"])}," 草稿 ",2),t("button",{onClick:e[3]||(e[3]=r=>_("archived")),class:f(["px-4 py-2 rounded-lg font-medium transition-colors",m.value==="archived"?"bg-indigo-600 text-white":"bg-white text-gray-700 hover:bg-gray-100 border border-gray-300"])}," 已归档 ",2)]),t("div",Ce,[e[6]||(e[6]=t("label",{for:"sortOrder",class:"text-sm text-gray-600 mr-2"},"排序方式:",-1)),ae(t("select",{id:"sortOrder","onUpdate:modelValue":e[4]||(e[4]=r=>D.value=r),onChange:P,class:"py-2 px-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent"},e[5]||(e[5]=[t("option",{value:"newest"},"最新创建",-1),t("option",{value:"name"},"按名称",-1),t("option",{value:"last_run"},"最近执行",-1),t("option",{value:"most_run"},"执行次数",-1)]),544),[[le,D.value]])])]),t("div",$e,[(a(!0),g(ie,null,ce(T.value,r=>(a(),g("div",{key:r.id,class:"workflow-card bg-white overflow-hidden rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-2"},[t("div",We,[t("div",De,[t("div",je,[t("div",{class:f(["w-10 h-10 rounded-full flex items-center justify-center mr-3",R(j(r))])},[(a(),M(ue(I(j(r))),{class:f([U(j(r)),"w-5 h-5"])},null,8,["class"]))],2),t("div",null,[t("h3",Ee,p(r.name),1),t("div",Me,[t("span",{class:f(G(r.status))},p(q(r.status)),3),t("span",Ae,"更新于 "+p(z(r.updatedAt||r.updated_at)),1)])])]),t("div",Be,[t("button",{onClick:l=>H(r.id),class:"text-gray-500 hover:text-gray-700 focus:outline-none p-1"},[n(i(be),{class:"w-5 h-5"})],8,Le),c.value===r.id?(a(),g("div",Fe,[t("div",Ve,[t("button",{onClick:l=>K(r.id),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left"}," 编辑工作流 ",8,Ze),t("button",{onClick:l=>Q(r.id),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left"}," 复制工作流 ",8,Ne),t("button",{onClick:l=>X(r.id),class:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 w-full text-left"}," 归档工作流 ",8,Oe),e[7]||(e[7]=t("hr",{class:"my-1"},null,-1)),t("button",{onClick:l=>Y(r.id),class:"block px-4 py-2 text-sm text-red-600 hover:bg-red-50 w-full text-left"}," 删除工作流 ",8,Se)])])):C("",!0)])]),t("p",Te,p(r.description||"暂无描述"),1),t("div",Pe,[t("div",ze,[n(i(ye),{class:"w-4 h-4 text-gray-400 mr-1"}),t("span",Ie,p(r.agentCount||r.agent_count||0)+"个AI代理",1)]),t("div",Re,[n(i(ge),{class:"w-4 h-4 text-gray-400 mr-1"}),t("span",Ue,"执行 "+p(r.runCount||r.execution_count||0)+" 次",1)])]),t("div",Ge,[n(o,{to:`/workflows/${r.id}`,class:"text-indigo-600 hover:text-indigo-800 text-sm font-medium transition-colors"},{default:E(()=>e[8]||(e[8]=[$(" 查看详情 ")])),_:2,__:[8]},1032,["to"]),t("button",{onClick:l=>J(r.id),disabled:x.value.includes(r.id),class:"bg-indigo-600 hover:bg-indigo-700 disabled:bg-gray-400 text-white text-sm py-1 px-3 rounded-lg transition-colors flex items-center"},[x.value.includes(r.id)?(a(),M(i(A),{key:1,class:"w-4 h-4 mr-1 animate-spin"})):(a(),M(i(me),{key:0,class:"w-4 h-4 mr-1"})),e[9]||(e[9]=$(" 执行 "))],8,qe)])])]))),128)),n(o,{to:"/workflows/create",class:"workflow-card bg-white overflow-hidden rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 hover:-translate-y-2 border-2 border-dashed border-gray-300 hover:border-indigo-500"},{default:E(()=>[t("div",He,[t("div",Je,[n(i(O),{class:"w-6 h-6 text-indigo-600"})]),e[10]||(e[10]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"创建新工作流",-1)),e[11]||(e[11]=t("p",{class:"text-sm text-gray-600"},"开始构建您的自动化工作流",-1))])]),_:1})]),w.value.length===0&&!b.value&&!y.value?(a(),g("div",Ke,[t("div",Qe,[n(i(ve),{class:"w-8 h-8 text-gray-400"})]),e[13]||(e[13]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"还没有工作流",-1)),e[14]||(e[14]=t("p",{class:"text-gray-600 mb-6"},"创建您的第一个工作流来开始自动化任务",-1)),n(o,{to:"/workflows/create",class:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"},{default:E(()=>[n(i(O),{class:"w-5 h-5 mr-2"}),e[12]||(e[12]=$(" 创建工作流 "))]),_:1,__:[12]})])):C("",!0),y.value&&!b.value?(a(),g("div",Xe,[t("div",Ye,[n(i(fe),{class:"w-8 h-8 text-red-500"})]),e[16]||(e[16]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"加载失败",-1)),t("p",et,p(y.value),1),t("button",{onClick:v,class:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"},[n(i(A),{class:"w-5 h-5 mr-2"}),e[15]||(e[15]=$(" 重试 "))])])):C("",!0),b.value?(a(),g("div",tt,[n(i(A),{class:"w-8 h-8 mx-auto mb-4 text-indigo-600 animate-spin"}),e[17]||(e[17]=t("p",{class:"text-gray-600"},"加载工作流...",-1))])):C("",!0)])}}},gt=ee(st,[["__scopeId","data-v-5b05b776"]]);export{gt as default};
