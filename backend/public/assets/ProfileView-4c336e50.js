import{_ as V,g as w,q as g,h as T,c as o,a as t,t as i,e as x,F as u,i as y,j as b,d as _,n as f,b as $,w as A,B as R,M,m as D,r as H,o as r}from"./index-f19ebc4a.js";const F={class:"flex-1 overflow-y-auto bg-gray-50"},I={class:"bg-white border-b border-gray-200"},q={class:"max-w-7xl mx-auto px-6 py-6"},E={class:"flex items-center justify-between"},O={class:"flex items-center space-x-4"},U={class:"flex items-center space-x-2"},G={class:"text-2xl font-bold text-gray-900"},J={class:"bg-white border-b border-gray-200"},K={class:"max-w-7xl mx-auto px-6"},Q={class:"flex space-x-8"},X=["onClick"],Z={class:"max-w-7xl mx-auto px-6 py-8"},tt={key:0,class:"space-y-6"},et={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},st={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},at={class:"flex items-center justify-between"},ot={class:"flex items-center"},rt={key:0,class:"text-2xl font-bold text-gray-400"},nt={key:1,class:"text-3xl font-bold text-gray-900"},it={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},dt={class:"flex items-center justify-between"},lt={class:"flex items-center"},ct={key:0,class:"text-2xl font-bold text-gray-400"},pt={key:1,class:"text-3xl font-bold text-gray-900"},ft={key:0,class:"text-sm text-green-600 bg-green-100 px-2 py-1 rounded-full"},gt={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},xt={class:"flex items-center justify-between"},ut={class:"flex items-center"},yt={key:0,class:"text-2xl font-bold text-gray-400"},bt={key:1,class:"text-3xl font-bold text-gray-900"},vt={key:0,class:"text-sm text-gray-500"},mt={class:"bg-white rounded-lg shadow-sm border border-gray-200"},ht={class:"overflow-x-auto"},wt={class:"min-w-full divide-y divide-gray-200"},_t={class:"bg-white divide-y divide-gray-200"},kt={key:0},Ct={key:1},St={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Mt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Dt={class:"px-6 py-4 whitespace-nowrap text-sm"},Pt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Yt={class:"px-6 py-4 border-t border-gray-200 flex items-center justify-between"},Bt={class:"text-sm text-gray-500"},Wt={key:0},zt={key:1},Lt={key:0,class:"flex items-center space-x-2"},Nt=["disabled"],Vt=["onClick"],Tt=["disabled"],$t={key:1,class:"space-y-6"},At={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},Rt={key:0,class:"text-center py-8"},Ht={key:1,class:"text-center py-8"},Ft={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"},It={class:"font-medium text-gray-900"},qt={class:"text-sm text-gray-500 mt-1"},Et={class:"flex items-center justify-between mt-3"},Ot={class:"text-sm text-gray-500"},Ut=["onClick"],Gt={key:2,class:"space-y-6"},Jt={key:3,class:"space-y-6"},Kt={__name:"ProfileView",setup(Qt){const p=w("points"),P=[{id:"points",name:"资源点数管理",icon:"fas fa-coins"},{id:"workflows",name:"已购工作流",icon:"fas fa-project-diagram"},{id:"security",name:"账户安全",icon:"fas fa-shield-alt"},{id:"notifications",name:"通知设置",icon:"fas fa-bell"}],l=g({profile:!1,points:!1,statistics:!1,transactions:!1,workflows:!1}),k=g({points:0}),c=g({currentBalance:0,monthlyConsumption:0,totalRecharge:0,rechargeCount:0,totalSpent:0,purchasedWorkflowCount:0,recentTransactionCount:0}),v=w([]),n=g({total:0,page:1,pageSize:10,pages:0}),m=w([]),Y=async()=>{try{l.profile=!0;const a=await R.getProfile();a.status==="success"&&Object.assign(k,a.data)}catch(a){console.error("获取用户资料失败:",a)}finally{l.profile=!1}},B=async()=>{try{l.statistics=!0;const a=await M.getPointsStatistics();if(a.status==="success"){const e=a.data;c.currentBalance=e.currentBalance||0,c.totalRecharge=e.totalRecharge||0,c.totalSpent=e.totalSpent||0,c.purchasedWorkflowCount=e.purchasedWorkflowCount||0,c.recentTransactionCount=e.recentTransactionCount||0,c.monthlyConsumption=Math.min(e.totalSpent||0,1e3),c.rechargeCount=Math.ceil((e.totalRecharge||0)/1e3)}}catch(a){console.error("获取积分统计失败:",a)}finally{l.statistics=!1}},C=async(a=1)=>{try{l.transactions=!0;const e=await M.getPointsHistory({limit:n.pageSize,offset:(a-1)*n.pageSize});if(e.status==="success"){const d=e.data;v.value=(d.transactions||[]).map(s=>({id:s.id,date:S(s.createdAt),description:z(s.type,s.description),workflow:L(s),change:s.amount,balance:s.balance})),d.pagination&&(n.total=d.pagination.total,n.page=d.pagination.page,n.pages=d.pagination.pages)}}catch(e){console.error("获取积分交易历史失败:",e)}finally{l.transactions=!1}},W=async()=>{try{l.workflows=!0;const a=await D.getWorkflows({limit:20,purchased:!0});if(a.status==="success"){const e=a.data.workflows||[];m.value=e.filter(d=>d.agentId).map(d=>({id:d.id,name:d.name,description:d.description||"暂无描述",purchaseDate:S(d.createdAt,"YYYY-MM-DD")}))}}catch(a){console.error("获取已购买工作流失败:",a)}finally{l.workflows=!1}},S=(a,e="YYYY-MM-DD HH:mm")=>{if(!a)return"未知";const d=new Date(a);return e==="YYYY-MM-DD"?d.toLocaleDateString("zh-CN"):d.toLocaleString("zh-CN")},z=(a,e)=>({recharge:"充值",purchase:"购买工作流",execution:"执行工作流",refund:"退款"})[a]||e||"未知交易",L=a=>a.type==="execution"||a.type==="purchase"?a.description||"工作流":"-",h=a=>{C(a)},N=async a=>{try{const e=await D.executeWorkflow(a,{});e.status==="success"&&console.log("工作流执行成功:",e)}catch(e){console.error("执行工作流失败:",e)}};return T(async()=>{await Promise.all([Y(),B(),C(),W()])}),(a,e)=>{const d=H("router-link");return r(),o("div",F,[t("div",I,[t("div",q,[t("div",E,[e[7]||(e[7]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900"},"个人中心"),t("p",{class:"text-gray-600 mt-1"},"管理您的账户信息和资源")],-1)),t("div",O,[t("div",U,[e[3]||(e[3]=t("i",{class:"fas fa-coins text-yellow-500 text-xl"},null,-1)),t("span",G,i(c.currentBalance||k.points||0),1),e[4]||(e[4]=t("span",{class:"text-sm text-gray-500"},"积分",-1))]),e[5]||(e[5]=t("button",{class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"},[t("i",{class:"fas fa-bell mr-2"}),x(" 通知 ")],-1)),e[6]||(e[6]=t("button",{class:"px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"},[t("i",{class:"fas fa-cog mr-2"}),x(" 设置 ")],-1))])])])]),t("div",J,[t("div",K,[t("nav",Q,[(r(),o(u,null,y(P,s=>t("button",{key:s.id,onClick:j=>p.value=s.id,class:f(["py-4 px-1 border-b-2 font-medium text-sm transition-colors",p.value===s.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},[t("i",{class:f(s.icon+" mr-2")},null,2),x(" "+i(s.name),1)],10,X)),64))])])]),t("div",Z,[p.value==="points"?(r(),o("div",tt,[t("div",et,[t("div",st,[t("div",at,[t("div",null,[e[10]||(e[10]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"当前余额",-1)),t("div",ot,[e[9]||(e[9]=t("i",{class:"fas fa-coins text-yellow-500 text-2xl mr-3"},null,-1)),l.statistics?(r(),o("span",rt,e[8]||(e[8]=[t("i",{class:"fas fa-spinner fa-spin"},null,-1)]))):(r(),o("span",nt,i(c.currentBalance.toLocaleString()),1))])]),t("button",{onClick:e[0]||(e[0]=s=>a.$router.push("/recharge")),class:"px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"}," 充值 ")])]),t("div",it,[e[13]||(e[13]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"本月消耗",-1)),t("div",dt,[t("div",lt,[e[12]||(e[12]=t("i",{class:"fas fa-chart-line text-green-500 text-2xl mr-3"},null,-1)),l.statistics?(r(),o("span",ct,e[11]||(e[11]=[t("i",{class:"fas fa-spinner fa-spin"},null,-1)]))):(r(),o("span",pt,i(c.monthlyConsumption.toLocaleString()),1))]),l.statistics?b("",!0):(r(),o("span",ft," 近期活跃 "))])]),t("div",gt,[e[16]||(e[16]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"累计充值",-1)),t("div",xt,[t("div",ut,[e[15]||(e[15]=t("i",{class:"fas fa-credit-card text-purple-500 text-2xl mr-3"},null,-1)),l.statistics?(r(),o("span",yt,e[14]||(e[14]=[t("i",{class:"fas fa-spinner fa-spin"},null,-1)]))):(r(),o("span",bt,i(c.totalRecharge.toLocaleString()),1))]),l.statistics?b("",!0):(r(),o("span",vt," 共充值 "+i(c.rechargeCount)+" 次 ",1))])])]),t("div",mt,[e[20]||(e[20]=_('<div class="p-6 border-b border-gray-200" data-v-cdfdb7a1><div class="flex items-center justify-between" data-v-cdfdb7a1><h3 class="text-lg font-semibold text-gray-900" data-v-cdfdb7a1>资源点数消费明细</h3><div class="flex items-center space-x-4" data-v-cdfdb7a1><select class="border border-gray-300 rounded-lg px-3 py-2 text-sm" data-v-cdfdb7a1><option data-v-cdfdb7a1>最近7天</option><option data-v-cdfdb7a1>最近30天</option><option data-v-cdfdb7a1>最近90天</option></select><button class="px-3 py-2 text-sm text-gray-600 hover:text-gray-900 border border-gray-300 rounded-lg" data-v-cdfdb7a1><i class="fas fa-download mr-1" data-v-cdfdb7a1></i> 导出 </button></div></div></div>',1)),t("div",ht,[t("table",wt,[e[19]||(e[19]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"日期"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"描述"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"工作流"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"点数变化"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"余额")])],-1)),t("tbody",_t,[l.transactions?(r(),o("tr",kt,e[17]||(e[17]=[t("td",{colspan:"5",class:"px-6 py-8 text-center"},[t("i",{class:"fas fa-spinner fa-spin text-gray-400 text-xl mr-2"}),t("span",{class:"text-gray-500"},"正在加载交易记录...")],-1)]))):v.value.length===0?(r(),o("tr",Ct,e[18]||(e[18]=[t("td",{colspan:"5",class:"px-6 py-8 text-center"},[t("i",{class:"fas fa-history text-gray-300 text-3xl mb-2"}),t("p",{class:"text-gray-500"},"暂无交易记录")],-1)]))):(r(!0),o(u,{key:2},y(v.value,s=>(r(),o("tr",{key:s.id},[t("td",St,i(s.date),1),t("td",jt,i(s.description),1),t("td",Mt,i(s.workflow),1),t("td",Dt,[t("span",{class:f(s.change>0?"text-green-600":"text-red-600")},i(s.change>0?"+":"")+i(s.change.toLocaleString()),3)]),t("td",Pt,i(s.balance.toLocaleString()),1)]))),128))])])]),t("div",Yt,[t("div",Bt,[l.transactions?(r(),o("span",Wt,"加载中...")):(r(),o("span",zt," 显示 "+i(Math.min((n.page-1)*n.pageSize+1,n.total))+" 至 "+i(Math.min(n.page*n.pageSize,n.total))+" 条， 共 "+i(n.total)+" 条记录 ",1))]),!l.transactions&&n.pages>1?(r(),o("div",Lt,[t("button",{onClick:e[1]||(e[1]=s=>h(n.page-1)),disabled:n.page<=1,class:f(["px-3 py-1 text-sm border border-gray-300 rounded",n.page<=1?"text-gray-400 cursor-not-allowed":"text-gray-600 hover:text-gray-900"])}," 上一页 ",10,Nt),(r(!0),o(u,null,y(Math.min(n.pages,5),s=>(r(),o("button",{key:s,onClick:j=>h(s),class:f(["px-3 py-1 text-sm rounded",n.page===s?"bg-indigo-600 text-white":"text-gray-600 hover:text-gray-900 border border-gray-300"])},i(s),11,Vt))),128)),t("button",{onClick:e[2]||(e[2]=s=>h(n.page+1)),disabled:n.page>=n.pages,class:f(["px-3 py-1 text-sm border border-gray-300 rounded",n.page>=n.pages?"text-gray-400 cursor-not-allowed":"text-gray-600 hover:text-gray-900"])}," 下一页 ",10,Tt)])):b("",!0)])])])):p.value==="workflows"?(r(),o("div",$t,[t("div",At,[e[25]||(e[25]=t("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"已购买的工作流",-1)),l.workflows?(r(),o("div",Rt,e[21]||(e[21]=[t("i",{class:"fas fa-spinner fa-spin text-gray-400 text-xl mr-2"},null,-1),t("span",{class:"text-gray-500"},"正在加载工作流...",-1)]))):m.value.length===0?(r(),o("div",Ht,[e[23]||(e[23]=t("i",{class:"fas fa-project-diagram text-gray-300 text-3xl mb-4"},null,-1)),e[24]||(e[24]=t("p",{class:"text-gray-500 mb-4"},"暂无已购买的工作流",-1)),$(d,{to:"/agents",class:"inline-flex items-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors"},{default:A(()=>e[22]||(e[22]=[t("i",{class:"fas fa-store mr-2"},null,-1),x(" 浏览工作流市场 ")])),_:1,__:[22]})])):(r(),o("div",Ft,[(r(!0),o(u,null,y(m.value,s=>(r(),o("div",{key:s.id,class:"border border-gray-200 rounded-lg p-4 hover:bg-gray-50 cursor-pointer transition-colors"},[t("h4",It,i(s.name),1),t("p",qt,i(s.description),1),t("div",Et,[t("span",Ot,"购买于: "+i(s.purchaseDate),1),t("button",{onClick:j=>N(s.id),class:"text-indigo-600 hover:text-indigo-500 text-sm font-medium"}," 使用 ",8,Ut)])]))),128))]))])])):p.value==="security"?(r(),o("div",Gt,e[26]||(e[26]=[_('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6" data-v-cdfdb7a1><h3 class="text-lg font-semibold text-gray-900 mb-4" data-v-cdfdb7a1>账户安全设置</h3><div class="space-y-4" data-v-cdfdb7a1><div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg" data-v-cdfdb7a1><div data-v-cdfdb7a1><h4 class="font-medium text-gray-900" data-v-cdfdb7a1>登录密码</h4><p class="text-sm text-gray-500" data-v-cdfdb7a1>最后修改: 2023-06-01</p></div><button class="text-indigo-600 hover:text-indigo-500 text-sm" data-v-cdfdb7a1>修改</button></div><div class="flex items-center justify-between p-4 border border-gray-200 rounded-lg" data-v-cdfdb7a1><div data-v-cdfdb7a1><h4 class="font-medium text-gray-900" data-v-cdfdb7a1>两步验证</h4><p class="text-sm text-gray-500" data-v-cdfdb7a1>增强账户安全性</p></div><button class="text-indigo-600 hover:text-indigo-500 text-sm" data-v-cdfdb7a1>启用</button></div></div></div>',1)]))):p.value==="notifications"?(r(),o("div",Jt,e[27]||(e[27]=[_('<div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6" data-v-cdfdb7a1><h3 class="text-lg font-semibold text-gray-900 mb-4" data-v-cdfdb7a1>通知设置</h3><div class="space-y-4" data-v-cdfdb7a1><div class="flex items-center justify-between" data-v-cdfdb7a1><div data-v-cdfdb7a1><h4 class="font-medium text-gray-900" data-v-cdfdb7a1>邮件通知</h4><p class="text-sm text-gray-500" data-v-cdfdb7a1>接收工作流执行结果通知</p></div><label class="relative inline-flex items-center cursor-pointer" data-v-cdfdb7a1><input type="checkbox" class="sr-only peer" checked data-v-cdfdb7a1><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[&#39;&#39;] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600" data-v-cdfdb7a1></div></label></div><div class="flex items-center justify-between" data-v-cdfdb7a1><div data-v-cdfdb7a1><h4 class="font-medium text-gray-900" data-v-cdfdb7a1>系统通知</h4><p class="text-sm text-gray-500" data-v-cdfdb7a1>接收系统更新和维护通知</p></div><label class="relative inline-flex items-center cursor-pointer" data-v-cdfdb7a1><input type="checkbox" class="sr-only peer" data-v-cdfdb7a1><div class="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[&#39;&#39;] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600" data-v-cdfdb7a1></div></label></div></div></div>',1)]))):b("",!0)])])}}},Zt=V(Kt,[["__scopeId","data-v-cdfdb7a1"]]);export{Zt as default};
