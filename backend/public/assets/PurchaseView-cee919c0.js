import{_ as D,g as m,q as w,v as G,h as z,c as r,a as e,t as i,b as F,w as U,F as P,i as k,y as q,A as E,n as d,e as y,j as f,M as J,P as A,r as K,o as n}from"./index-f19ebc4a.js";const O={name:"PurchaseView",setup(){const p=m(!1),s=m(!1),b=m(0),t=m("all"),I=m([{id:"all",name:"全部服务",icon:"fas fa-th-large"},{id:"ai_model",name:"AI模型",icon:"fas fa-brain"},{id:"storage",name:"存储服务",icon:"fas fa-database"},{id:"compute",name:"计算资源",icon:"fas fa-server"},{id:"api",name:"API调用",icon:"fas fa-plug"},{id:"premium",name:"高级功能",icon:"fas fa-crown"}]),C=m([{id:1,name:"GPT-4 调用包",category:"AI模型",categoryId:"ai_model",description:"1000次GPT-4 API调用额度，适合高质量文本生成需求",features:["1000次API调用","支持最新GPT-4模型","30天有效期"],price:5e3,originalPrice:6e3,icon:"fas fa-robot",color:"bg-blue-500",popular:!0},{id:2,name:"云存储空间",category:"存储服务",categoryId:"storage",description:"100GB云端存储空间，用于保存工作流和数据文件",features:["100GB存储空间","高速访问","自动备份"],price:2e3,icon:"fas fa-cloud",color:"bg-green-500",popular:!1},{id:3,name:"高级计算资源",category:"计算资源",categoryId:"compute",description:"专用计算节点，提供更强的工作流执行性能",features:["专用CPU资源","优先队列","高内存配置"],price:8e3,icon:"fas fa-microchip",color:"bg-purple-500",popular:!1},{id:4,name:"API访问包",category:"API调用",categoryId:"api",description:"第三方API调用额度，支持各种外部服务集成",features:["10000次API调用","支持多种第三方服务","无限制频率"],price:3e3,icon:"fas fa-exchange-alt",color:"bg-orange-500",popular:!0},{id:5,name:"高级分析功能",category:"高级功能",categoryId:"premium",description:"解锁高级数据分析和可视化功能",features:["高级图表","数据导出","自定义报告"],price:4500,icon:"fas fa-chart-line",color:"bg-indigo-500",popular:!1},{id:6,name:"批量处理套餐",category:"AI模型",categoryId:"ai_model",description:"大批量数据处理，适合企业级应用",features:["无限批量处理","并行执行","优先处理"],price:12e3,originalPrice:15e3,icon:"fas fa-layer-group",color:"bg-red-500",popular:!1}]),h=m([]),a=w({status:""}),l=w({page:1,limit:20,total:0}),g=w({show:!1,service:null}),u=w({show:!1,type:"info",title:"",message:""}),B=G(()=>t.value==="all"?C.value:C.value.filter(o=>o.categoryId===t.value)),L=o=>(o==null?void 0:o.toLocaleString())||"0",S=o=>new Date(o).toLocaleString("zh-CN"),H=o=>({pending:"处理中",completed:"已完成",failed:"失败",cancelled:"已取消"})[o]||o,_=(o,c,x)=>{u.show=!0,u.type=o,u.title=c,u.message=x,setTimeout(()=>{u.show=!1},5e3)},M=async()=>{var o;try{const c=await J.getPoints();b.value=((o=c.data)==null?void 0:o.balance)||0}catch(c){console.error("加载余额失败:",c)}},N=o=>{if(b.value<o.price){_("error","积分不足","请先充值积分");return}g.service=o,g.show=!0},V=async()=>{if(g.service){s.value=!0;try{const o={serviceId:g.service.id,serviceName:g.service.name,category:g.service.category,price:g.service.price};await A.createPurchase(o),_("success","购买成功",`成功购买 ${g.service.name}`),M(),v(),g.show=!1,g.service=null}catch(o){console.error("购买失败:",o);let c="购买失败，请稍后重试";o.response&&o.response.data&&o.response.data.message&&(c=o.response.data.message),_("error","购买失败",c)}finally{s.value=!1}}},v=async()=>{var o,c;p.value=!0;try{const x={page:l.page,limit:l.limit};a.status&&(x.status=a.status);const j=await A.getPurchaseHistory(x);h.value=((o=j.data)==null?void 0:o.records)||[],l.total=((c=j.data)==null?void 0:c.total)||0}catch(x){console.error("加载购买历史失败:",x),_("error","加载失败","无法加载购买历史")}finally{p.value=!1}},T=o=>{o>=1&&o<=Math.ceil(l.total/l.limit)&&(l.page=o,v())};return z(()=>{M(),v()}),{historyLoading:p,purchaseLoading:s,currentBalance:b,selectedCategory:t,serviceCategories:I,filteredServices:B,purchaseHistory:h,filters:a,pagination:l,confirmModal:g,notification:u,formatPoints:L,formatDate:S,getStatusText:H,purchaseService:N,confirmPurchase:V,loadPurchaseHistory:v,changePage:T}}},Q={class:"container mx-auto px-4 py-6"},R={class:"bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-6 text-white mb-8"},W={class:"flex items-center justify-between"},X={class:"text-3xl font-bold"},Y={class:"mt-4"},Z={class:"mb-8"},$={class:"flex flex-wrap gap-4"},ee=["onClick"],te={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"},se={class:"p-6"},ae={class:"flex items-start justify-between mb-4"},oe={class:"flex items-center"},ie={class:"font-medium text-gray-900"},re={class:"text-sm text-gray-500"},ne={key:0,class:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full"},le={class:"text-gray-600 text-sm mb-4"},ce={class:"mb-4"},de={class:"space-y-1"},ge={class:"flex items-center justify-between"},me={class:"text-lg font-semibold text-gray-900"},fe={key:0,class:"text-xs text-gray-400 line-through"},ue=["onClick","disabled"],xe={class:"bg-white rounded-lg shadow-sm border"},ye={class:"px-6 py-4 border-b border-gray-200"},pe={class:"flex justify-between items-center"},be={class:"flex items-center space-x-4"},he=["disabled"],_e={class:"p-6"},ve={key:0,class:"text-center py-8"},we={key:1,class:"space-y-4"},Pe={class:"flex items-center"},ke={class:"font-medium text-gray-900"},Ce={class:"text-sm text-gray-500"},Ie={class:"text-right"},Me={class:"font-semibold text-gray-900"},je={class:"text-sm text-gray-500"},Ae={key:2,class:"text-center py-8"},Be={key:3,class:"mt-6 flex justify-center"},Le={class:"flex items-center space-x-2"},Se=["disabled"],He={class:"text-sm text-gray-600"},Ne=["disabled"],Ve={key:0,class:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50 p-4"},Te={class:"bg-white rounded-lg shadow-xl w-full max-w-md overflow-hidden"},De={class:"p-6"},Ge={key:0,class:"space-y-4"},ze={class:"flex items-center"},Fe={class:"font-medium text-gray-900"},Ue={class:"text-sm text-gray-500"},qe={class:"bg-gray-50 rounded-lg p-4"},Ee={class:"flex justify-between items-center mb-2"},Je={class:"font-medium"},Ke={class:"flex justify-between items-center mb-2"},Oe={class:"font-medium"},Qe={class:"flex justify-between items-center"},Re={class:"font-medium text-blue-600"},We={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end"},Xe=["disabled"],Ye=["disabled"],Ze={key:0,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"},$e={key:1,class:"fixed top-4 right-4 max-w-md z-50"},et={class:"flex items-start"},tt={class:"flex-1"},st={class:"font-medium"},at={class:"text-sm"};function ot(p,s,b,t,I,C){const h=K("router-link");return n(),r("div",Q,[s[24]||(s[24]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900 mb-2"},"服务购买"),e("p",{class:"text-gray-600"},"使用积分购买各种AI服务和功能")],-1)),e("div",R,[e("div",W,[e("div",null,[s[8]||(s[8]=e("p",{class:"text-green-100 text-sm"},"可用积分余额",-1)),e("p",X,i(t.formatPoints(t.currentBalance)),1)]),s[9]||(s[9]=e("div",{class:"text-green-200"},[e("i",{class:"fas fa-wallet text-3xl"})],-1))]),e("div",Y,[F(h,{to:"/recharge",class:"inline-flex items-center text-sm text-green-100 hover:text-white"},{default:U(()=>s[10]||(s[10]=[e("i",{class:"fas fa-plus-circle mr-1"},null,-1),y(" 充值积分 ")])),_:1,__:[10]})])]),e("div",Z,[e("div",$,[(n(!0),r(P,null,k(t.serviceCategories,a=>(n(),r("button",{key:a.id,onClick:l=>t.selectedCategory=a.id,class:d(["px-4 py-2 rounded-lg font-medium transition-colors",t.selectedCategory===a.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},[e("i",{class:d([a.icon,"mr-2"])},null,2),y(" "+i(a.name),1)],10,ee))),128))])]),e("div",te,[(n(!0),r(P,null,k(t.filteredServices,a=>(n(),r("div",{key:a.id,class:"bg-white rounded-lg shadow-sm border hover:shadow-md transition-shadow"},[e("div",se,[e("div",ae,[e("div",oe,[e("div",{class:d(["w-12 h-12 rounded-lg flex items-center justify-center mr-3",a.color])},[e("i",{class:d([a.icon,"text-white text-xl"])},null,2)],2),e("div",null,[e("h3",ie,i(a.name),1),e("p",re,i(a.category),1)])]),a.popular?(n(),r("div",ne," 热门 ")):f("",!0)]),e("p",le,i(a.description),1),e("div",ce,[e("ul",de,[(n(!0),r(P,null,k(a.features,l=>(n(),r("li",{key:l,class:"text-sm text-gray-600 flex items-center"},[s[11]||(s[11]=e("i",{class:"fas fa-check text-green-500 text-xs mr-2"},null,-1)),y(" "+i(l),1)]))),128))])]),e("div",ge,[e("div",null,[e("span",me,i(t.formatPoints(a.price)),1),s[12]||(s[12]=e("span",{class:"text-sm text-gray-500 ml-1"},"积分",-1)),a.originalPrice&&a.originalPrice>a.price?(n(),r("div",fe," 原价 "+i(t.formatPoints(a.originalPrice))+" 积分 ",1)):f("",!0)]),e("button",{onClick:l=>t.purchaseService(a),disabled:t.currentBalance<a.price,class:d(["px-4 py-2 rounded-lg font-medium transition-colors",t.currentBalance>=a.price?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"])},i(t.currentBalance>=a.price?"购买":"积分不足"),11,ue)])])]))),128))]),e("div",xe,[e("div",ye,[e("div",pe,[s[15]||(s[15]=e("h3",{class:"text-lg font-medium text-gray-900"},"购买历史",-1)),e("div",be,[q(e("select",{"onUpdate:modelValue":s[0]||(s[0]=a=>t.filters.status=a),class:"border border-gray-300 rounded-md px-3 py-1 text-sm",onChange:s[1]||(s[1]=(...a)=>t.loadPurchaseHistory&&t.loadPurchaseHistory(...a))},s[13]||(s[13]=[e("option",{value:""},"全部状态",-1),e("option",{value:"completed"},"已完成",-1),e("option",{value:"pending"},"处理中",-1),e("option",{value:"failed"},"失败",-1)]),544),[[E,t.filters.status]]),e("button",{onClick:s[2]||(s[2]=(...a)=>t.loadPurchaseHistory&&t.loadPurchaseHistory(...a)),class:"text-blue-600 hover:text-blue-800 text-sm",disabled:t.historyLoading},[e("i",{class:d(["fas fa-sync-alt",{"animate-spin":t.historyLoading}])},null,2),s[14]||(s[14]=y(" 刷新 "))],8,he)])])]),e("div",_e,[t.historyLoading?(n(),r("div",ve,s[16]||(s[16]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mx-auto"},null,-1),e("p",{class:"text-gray-500 mt-2"},"加载中...",-1)]))):t.purchaseHistory.length>0?(n(),r("div",we,[(n(!0),r(P,null,k(t.purchaseHistory,a=>(n(),r("div",{key:a.id,class:"flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:bg-gray-50"},[e("div",Pe,[e("div",{class:d(["w-10 h-10 rounded-lg flex items-center justify-center mr-3",a.status==="completed"?"bg-green-100 text-green-600":a.status==="pending"?"bg-yellow-100 text-yellow-600":"bg-red-100 text-red-600"])},[e("i",{class:d(["fas",a.status==="completed"?"fa-check":a.status==="pending"?"fa-clock":"fa-times"])},null,2)],2),e("div",null,[e("p",ke,i(a.serviceName),1),e("p",Ce,i(t.formatDate(a.createdAt))+" · "+i(t.getStatusText(a.status)),1)])]),e("div",Ie,[e("p",Me,i(t.formatPoints(a.price))+" 积分",1),e("p",je,i(a.category),1)])]))),128))])):(n(),r("div",Ae,s[17]||(s[17]=[e("i",{class:"fas fa-shopping-bag text-4xl text-gray-300 mb-4"},null,-1),e("p",{class:"text-gray-500"},"暂无购买记录",-1)]))),t.pagination.total>t.pagination.limit?(n(),r("div",Be,[e("nav",Le,[e("button",{onClick:s[3]||(s[3]=a=>t.changePage(t.pagination.page-1)),disabled:t.pagination.page===1,class:"px-3 py-1 border border-gray-300 rounded-md text-sm hover:bg-gray-50 disabled:opacity-50"}," 上一页 ",8,Se),e("span",He," 第 "+i(t.pagination.page)+" 页，共 "+i(Math.ceil(t.pagination.total/t.pagination.limit))+" 页 ",1),e("button",{onClick:s[4]||(s[4]=a=>t.changePage(t.pagination.page+1)),disabled:t.pagination.page>=Math.ceil(t.pagination.total/t.pagination.limit),class:"px-3 py-1 border border-gray-300 rounded-md text-sm hover:bg-gray-50 disabled:opacity-50"}," 下一页 ",8,Ne)])])):f("",!0)])]),t.confirmModal.show?(n(),r("div",Ve,[e("div",Te,[s[22]||(s[22]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-medium text-gray-900"},"确认购买")],-1)),e("div",De,[t.confirmModal.service?(n(),r("div",Ge,[e("div",ze,[e("div",{class:d(["w-12 h-12 rounded-lg flex items-center justify-center mr-3",t.confirmModal.service.color])},[e("i",{class:d([t.confirmModal.service.icon,"text-white text-xl"])},null,2)],2),e("div",null,[e("h4",Fe,i(t.confirmModal.service.name),1),e("p",Ue,i(t.confirmModal.service.category),1)])]),e("div",qe,[e("div",Ee,[s[18]||(s[18]=e("span",{class:"text-gray-600"},"服务价格:",-1)),e("span",Je,i(t.formatPoints(t.confirmModal.service.price))+" 积分",1)]),e("div",Ke,[s[19]||(s[19]=e("span",{class:"text-gray-600"},"当前余额:",-1)),e("span",Oe,i(t.formatPoints(t.currentBalance))+" 积分",1)]),s[21]||(s[21]=e("hr",{class:"my-2"},null,-1)),e("div",Qe,[s[20]||(s[20]=e("span",{class:"text-gray-600"},"购买后余额:",-1)),e("span",Re,i(t.formatPoints(t.currentBalance-t.confirmModal.service.price))+" 积分",1)])])])):f("",!0)]),e("div",We,[e("button",{onClick:s[5]||(s[5]=a=>t.confirmModal.show=!1),class:"px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg mr-2",disabled:t.purchaseLoading}," 取消 ",8,Xe),e("button",{onClick:s[6]||(s[6]=(...a)=>t.confirmPurchase&&t.confirmPurchase(...a)),class:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center",disabled:t.purchaseLoading},[t.purchaseLoading?(n(),r("span",Ze)):f("",!0),y(" "+i(t.purchaseLoading?"购买中...":"确认购买"),1)],8,Ye)])])])):f("",!0),t.notification.show?(n(),r("div",$e,[e("div",{class:d(["p-4 rounded-lg shadow-lg",t.notification.type==="success"?"bg-green-100 text-green-800 border-l-4 border-green-500":"bg-red-100 text-red-800 border-l-4 border-red-500"])},[e("div",et,[e("i",{class:d(["fas mt-0.5 mr-3",t.notification.type==="success"?"fa-check-circle text-green-500":"fa-exclamation-circle text-red-500"])},null,2),e("div",tt,[e("p",st,i(t.notification.title),1),e("p",at,i(t.notification.message),1)]),e("button",{onClick:s[7]||(s[7]=a=>t.notification.show=!1),class:"ml-4 text-gray-500 hover:text-gray-700"},s[23]||(s[23]=[e("i",{class:"fas fa-times"},null,-1)]))])],2)])):f("",!0)])}const rt=D(O,[["render",ot],["__scopeId","data-v-d215b331"]]);export{rt as default};
