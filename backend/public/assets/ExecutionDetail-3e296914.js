import{_ as $,I as O,C as j,D as F,g as i,h as R,c as a,a as t,b as _,w as b,t as d,n as f,j as u,F as M,i as I,r as H,o,e as h}from"./index-f19ebc4a.js";import{u as P}from"./execution-f5fce53c.js";const W={class:"execution-detail"},q={class:"flex justify-between items-center mb-6"},G={key:0,class:"flex justify-center items-center py-12"},K={key:1,class:"bg-red-50 dark:bg-red-900/20 p-4 rounded-md"},Q={class:"flex"},U={class:"ml-3"},X={class:"mt-2 text-sm text-red-700 dark:text-red-300"},Y={key:2,class:"space-y-6"},Z={class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},tt={class:"px-6 py-5"},et={class:"grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-6"},st={class:"col-span-1"},rt={class:"mt-1 text-sm text-gray-900 dark:text-gray-200"},at={class:"col-span-1"},ot={class:"mt-1 text-sm text-gray-900 dark:text-gray-200"},dt={class:"col-span-1"},lt={class:"mt-1 text-sm text-gray-900 dark:text-gray-200"},nt={class:"col-span-1"},it={class:"mt-1 text-sm"},ut={class:"col-span-1"},ct={class:"mt-1 text-sm text-gray-900 dark:text-gray-200"},gt={class:"col-span-1"},xt={class:"mt-1 text-sm text-gray-900 dark:text-gray-200"},yt={class:"col-span-1"},mt={class:"mt-1 text-sm text-gray-900 dark:text-gray-200"},vt={key:0,class:"col-span-1"},pt={class:"mt-1 text-sm text-gray-900 dark:text-gray-200"},kt={key:0,class:"flex justify-end"},_t=["disabled"],bt={key:0},ft={key:1},ht={class:"border-b border-gray-200 dark:border-gray-700"},wt={class:"-mb-px flex space-x-8"},Dt=["onClick"],Ct={class:"mt-6"},Mt={key:0,class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},It={class:"px-6 py-5 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center"},Lt=["disabled"],Et={key:0},Nt={key:1},Tt={class:"p-6"},zt={key:0,class:"bg-gray-100 dark:bg-gray-900 p-4 rounded-md overflow-auto max-h-96 font-mono text-sm"},Bt={class:"text-gray-500 dark:text-gray-400"},St={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Vt={key:1,class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},At={class:"p-6"},Jt={key:0,class:"bg-gray-100 dark:bg-gray-900 p-4 rounded-md overflow-auto max-h-96"},$t={class:"text-sm font-mono"},Ot={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},jt={key:2,class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},Ft={class:"p-6"},Rt={key:0,class:"bg-gray-100 dark:bg-gray-900 p-4 rounded-md overflow-auto max-h-96"},Ht={class:"text-sm font-mono"},Pt={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Wt={key:2,class:"text-center py-8 text-gray-500 dark:text-gray-400"},qt={key:3,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Gt={key:3,class:"bg-white dark:bg-gray-800 shadow rounded-lg overflow-hidden"},Kt={class:"p-6"},Qt={key:0,class:"bg-red-50 dark:bg-red-900/20 p-4 rounded-md text-red-700 dark:text-red-300"},Ut={class:"text-sm font-mono whitespace-pre-wrap"},Xt={key:1,class:"text-center py-8 text-gray-500 dark:text-gray-400"},Yt={key:3,class:"bg-yellow-50 dark:bg-yellow-900/20 p-4 rounded-md"},Zt={class:"flex"},te={class:"ml-3"},ee={class:"mt-2 text-sm text-yellow-700 dark:text-yellow-300"},se={__name:"ExecutionDetail",setup(re){const L=O();j();const y=P(),m=F(),v=i(!0),c=i(null),r=i(null),n=i("logs"),g=i(!1),x=i(!1),E=[{id:"logs",name:"执行日志"},{id:"input",name:"输入数据"},{id:"output",name:"输出结果"},{id:"error",name:"错误信息"}],k=async()=>{const s=L.params.id;if(!s){c.value="无效的执行ID",v.value=!1;return}v.value=!0,c.value=null;try{const e=await y.fetchExecutionById(s);r.value=e}catch(e){c.value=e.message||"获取执行详情失败",console.error("获取执行详情失败:",e)}finally{v.value=!1}},N=async()=>{if(!(!r.value||x.value)){x.value=!0;try{await k(),m.success("日志已刷新")}catch(s){m.error("刷新日志失败: "+(s.message||"未知错误"))}finally{x.value=!1}}},T=async()=>{if(!(!r.value||g.value)&&["running","pending"].includes(r.value.status)){g.value=!0;try{await y.cancelExecution(r.value.id),m.success("执行已取消"),await k()}catch(s){m.error("取消执行失败: "+(s.message||"未知错误"))}finally{g.value=!1}}},w=s=>s?y.formatDateTime(s):"",z=s=>!s&&s!==0?"计算中...":y.formatDuration(s),D=s=>{try{return JSON.stringify(typeof s=="string"?JSON.parse(s):s,null,2)}catch{return s}},B=s=>s?new Date(s).toLocaleTimeString("zh-CN"):"",S=s=>({pending:"等待中",running:"运行中",success:"成功",failed:"失败",cancelled:"已取消"})[s]||s,V=s=>({pending:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",running:"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-300",success:"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300",failed:"bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-300",cancelled:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-300"})[s]||"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-300",A=s=>{const e=s.triggerType||s.trigger_type;return{manual:"手动触发",scheduled:"定时触发",webhook:"Webhook触发",api:"API触发"}[e]||e||"未知"},J=s=>({error:"text-red-600 dark:text-red-400",warn:"text-yellow-600 dark:text-yellow-400",info:"text-blue-600 dark:text-blue-400",debug:"text-gray-600 dark:text-gray-400"})[s==null?void 0:s.toLowerCase()]||"text-gray-900 dark:text-gray-200";return R(()=>{k()}),(s,e)=>{const p=H("router-link");return o(),a("div",W,[t("div",q,[e[1]||(e[1]=t("div",null,[t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," 执行详情 "),t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," 查看工作流执行的详细信息、日志和结果 ")],-1)),_(p,{to:{name:"Executions"},class:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none"},{default:b(()=>e[0]||(e[0]=[h(" 返回列表 ")])),_:1,__:[0]})]),v.value?(o(),a("div",G,e[2]||(e[2]=[t("div",{class:"spinner"},null,-1),t("span",{class:"ml-3"},"加载执行详情...",-1)]))):c.value?(o(),a("div",K,[t("div",Q,[e[4]||(e[4]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),t("div",U,[e[3]||(e[3]=t("h3",{class:"text-sm font-medium text-red-800 dark:text-red-200"},"加载失败",-1)),t("div",X,[t("p",null,d(c.value),1)])])])])):r.value?(o(),a("div",Y,[t("div",Z,[e[13]||(e[13]=t("div",{class:"px-6 py-5 border-b border-gray-200 dark:border-gray-700"},[t("h2",{class:"text-lg font-medium text-gray-900 dark:text-white"},"基本信息")],-1)),t("div",tt,[t("dl",et,[t("div",st,[e[5]||(e[5]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"执行ID",-1)),t("dd",rt,d(r.value.id),1)]),t("div",at,[e[6]||(e[6]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"工作流",-1)),t("dd",ot,[_(p,{to:`/workflows/${r.value.workflowId}`,class:"text-primary-600 dark:text-primary-400 hover:underline"},{default:b(()=>[h(d(r.value.workflowName),1)]),_:1},8,["to"])])]),t("div",dt,[e[7]||(e[7]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"触发方式",-1)),t("dd",lt,d(A(r.value)),1)]),t("div",nt,[e[8]||(e[8]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"状态",-1)),t("dd",it,[t("span",{class:f([V(r.value.status),"px-2 py-1 text-xs font-medium rounded-full"])},d(S(r.value.status)),3)])]),t("div",ut,[e[9]||(e[9]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"开始时间",-1)),t("dd",ct,d(w(r.value.startedAt)),1)]),t("div",gt,[e[10]||(e[10]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"结束时间",-1)),t("dd",xt,d(r.value.completedAt?w(r.value.completedAt):"尚未完成"),1)]),t("div",yt,[e[11]||(e[11]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"执行时长",-1)),t("dd",mt,d(z(r.value.duration)),1)]),r.value.agentId?(o(),a("div",vt,[e[12]||(e[12]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"执行代理",-1)),t("dd",pt,[_(p,{to:`/agents/${r.value.agentId}`,class:"text-primary-600 dark:text-primary-400 hover:underline"},{default:b(()=>[h(d(r.value.agentName||r.value.agentId),1)]),_:1},8,["to"])])])):u("",!0)])])]),["running","pending"].includes(r.value.status)?(o(),a("div",kt,[t("button",{onClick:T,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500",disabled:g.value},[g.value?(o(),a("span",bt,"取消中...")):(o(),a("span",ft,"取消执行"))],8,_t)])):u("",!0),t("div",ht,[t("nav",wt,[(o(),a(M,null,I(E,l=>t("button",{key:l.id,onClick:C=>n.value=l.id,class:f([n.value===l.id?"border-primary-500 text-primary-600 dark:text-primary-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300 dark:hover:border-gray-600","whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"])},d(l.name),11,Dt)),64))])]),t("div",Ct,[n.value==="logs"?(o(),a("div",Mt,[t("div",It,[e[14]||(e[14]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"执行日志",-1)),t("button",{onClick:N,class:"text-sm text-primary-600 dark:text-primary-400 hover:text-primary-800 dark:hover:text-primary-300 focus:outline-none",disabled:x.value},[x.value?(o(),a("span",Et,"刷新中...")):(o(),a("span",Nt,"刷新日志"))],8,Lt)]),t("div",Tt,[r.value.logs&&r.value.logs.length>0?(o(),a("div",zt,[(o(!0),a(M,null,I(r.value.logs,(l,C)=>(o(),a("div",{key:C,class:"mb-1"},[t("span",Bt,d(B(l.timestamp)),1),t("span",{class:f([J(l.level),"ml-2"])},d(l.message),3)]))),128))])):(o(),a("div",St," 暂无日志记录 "))])])):u("",!0),n.value==="input"?(o(),a("div",Vt,[e[15]||(e[15]=t("div",{class:"px-6 py-5 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"输入数据")],-1)),t("div",At,[r.value.inputData?(o(),a("div",Jt,[t("pre",$t,d(D(r.value.inputData)),1)])):(o(),a("div",Ot," 无输入数据 "))])])):u("",!0),n.value==="output"?(o(),a("div",jt,[e[16]||(e[16]=t("div",{class:"px-6 py-5 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"输出结果")],-1)),t("div",Ft,[r.value.outputData?(o(),a("div",Rt,[t("pre",Ht,d(D(r.value.outputData)),1)])):r.value.status==="success"?(o(),a("div",Pt," 执行成功但无返回数据 ")):["running","pending"].includes(r.value.status)?(o(),a("div",Wt," 执行尚未完成，暂无输出数据 ")):(o(),a("div",qt," 无输出数据 "))])])):u("",!0),n.value==="error"?(o(),a("div",Gt,[e[17]||(e[17]=t("div",{class:"px-6 py-5 border-b border-gray-200 dark:border-gray-700"},[t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white"},"错误信息")],-1)),t("div",Kt,[r.value.errorMessage?(o(),a("div",Qt,[t("pre",Ut,d(r.value.errorMessage),1)])):(o(),a("div",Xt," 无错误信息 "))])])):u("",!0)])])):(o(),a("div",Yt,[t("div",Zt,[e[19]||(e[19]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-yellow-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})])],-1)),t("div",te,[e[18]||(e[18]=t("h3",{class:"text-sm font-medium text-yellow-800 dark:text-yellow-200"},"未找到执行记录",-1)),t("div",ee,[t("p",null,'无法找到ID为 "'+d(s.$route.params.id)+'" 的执行记录，请返回列表查看其他执行记录。',1)])])])]))])}}},de=$(se,[["__scopeId","data-v-126cbdbc"]]);export{de as default};
