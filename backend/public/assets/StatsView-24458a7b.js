import{o as l,c as d,a as t,D as K,g as c,v as Z,h as q,b as i,n as m,u as r,y as G,A as H,t as a,e as y,l as N,F as k,i as S,j as J,s as M,L as P}from"./index-f19ebc4a.js";import{r as F}from"./ArrowPathIcon-48974b59.js";import{r as Q}from"./ArrowDownTrayIcon-8a8886b9.js";import{r as X}from"./ExclamationTriangleIcon-acab16c9.js";import{a as Y,r as w}from"./PlayCircleIcon-099ac575.js";import{r as tt}from"./CheckCircleIcon-a0df62da.js";import{r as et}from"./ClockIcon-cbcc2b6e.js";import{r as st}from"./ChartBarIcon-fa691178.js";import{r as ot}from"./RectangleGroupIcon-67d3093d.js";function at(C,g){return l(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.25 6 9 12.75l4.286-4.286a11.948 11.948 0 0 1 4.306 6.43l.776 2.898m0 0 3.182-5.511m-3.182 5.51-5.511-3.181"})])}function nt(C,g){return l(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}const rt={class:"flex-1 overflow-y-auto p-6"},lt={class:"flex items-center justify-between mb-6"},it={class:"flex items-center space-x-4"},dt=["disabled"],ct={class:"bg-white rounded-lg p-4 mb-6 shadow-sm"},ut={class:"flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0"},mt={class:"flex flex-wrap gap-2"},gt={key:0,class:"flex justify-center items-center py-12"},xt={key:1,class:"bg-red-50 p-4 rounded-lg"},pt={class:"flex"},ht={class:"flex-shrink-0"},_t={class:"ml-3"},ft={class:"mt-2 text-sm text-red-700"},vt={key:2,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},yt={class:"bg-white rounded-lg p-6 shadow-sm"},wt={class:"flex items-center"},bt={class:"p-2 bg-blue-100 rounded-lg"},kt={class:"ml-4"},St={class:"flex items-baseline"},Mt={class:"text-2xl font-semibold text-gray-900"},Ct={class:"ml-2 text-sm font-medium text-green-600 flex items-center"},$t={class:"bg-white rounded-lg p-6 shadow-sm"},Dt={class:"flex items-center"},jt={class:"p-2 bg-yellow-100 rounded-lg"},Tt={class:"ml-4"},Bt={class:"flex items-baseline"},Et={class:"text-2xl font-semibold text-gray-900"},Vt={class:"ml-2 text-sm font-medium text-green-600 flex items-center"},Nt={class:"bg-white rounded-lg p-6 shadow-sm"},Pt={class:"flex items-center"},Ft={class:"p-2 bg-green-100 rounded-lg"},Ot={class:"ml-4"},zt={class:"flex items-baseline"},At={class:"text-2xl font-semibold text-gray-900"},It={class:"ml-2 text-sm font-medium text-green-600 flex items-center"},Lt={class:"bg-white rounded-lg p-6 shadow-sm"},Rt={class:"flex items-center"},Ut={class:"p-2 bg-indigo-100 rounded-lg"},Wt={class:"ml-4"},Kt={class:"flex items-baseline"},Zt={class:"text-2xl font-semibold text-gray-900"},qt={class:"grid grid-cols-1 lg:grid-cols-2 gap-8"},Gt={class:"bg-white rounded-lg p-6 shadow-sm"},Ht={class:"flex items-center justify-between mb-4"},Jt={class:"flex items-center space-x-2"},Qt={class:"h-80 flex items-center justify-center bg-gray-50 rounded-lg"},Xt={class:"text-center"},Yt={class:"text-gray-500"},te={class:"text-xs text-gray-400 mt-1"},ee={class:"bg-white rounded-lg p-6 shadow-sm"},se={class:"space-y-4"},oe={class:"flex items-center"},ae={class:"text-sm font-medium text-gray-700"},ne={class:"flex items-center"},re={class:"text-sm text-gray-900 font-medium"},le={class:"text-xs text-gray-500 ml-2"},ie={class:"mt-6"},de={class:"flex rounded-lg overflow-hidden h-3"},ce={key:3,class:"mt-8 bg-white rounded-lg shadow-sm"},ue={class:"overflow-x-auto"},me={class:"min-w-full divide-y divide-gray-200"},ge={class:"bg-white divide-y divide-gray-200"},xe={class:"px-6 py-4 whitespace-nowrap"},pe={class:"flex items-center"},he={class:"text-sm font-medium text-gray-900"},_e={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},fe={class:"px-6 py-4 whitespace-nowrap text-sm text-green-600"},ve={class:"px-6 py-4 whitespace-nowrap text-sm text-red-600"},ye={class:"px-6 py-4 whitespace-nowrap"},we={class:"flex items-center"},be={class:"w-16 bg-gray-200 rounded-full h-2 mr-2"},ke={class:"text-sm text-gray-900"},Se={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ne={__name:"StatsView",setup(C){const g=K(),x=c(!1),f=c(null),u=c("30d"),p=c("points"),h=c({}),_=c({}),b=c([]);c({total_executions:0,success_rate:0,avg_duration:0});const O=Z(()=>(h.value.total_executions||0)*25),z=async()=>{try{const s=await M.getDashboardStats();if(s.status==="success")return h.value=s.data,s.data;throw new Error(s.message||"获取仪表盘统计失败")}catch(s){throw console.error("获取仪表盘统计失败:",s),s}},$=async()=>{try{const s={};if(u.value!=="all"){const o=new Date;let n;switch(u.value){case"7d":n=new Date(o.getTime()-7*24*60*60*1e3);break;case"30d":n=new Date(o.getTime()-30*24*60*60*1e3);break;case"90d":n=new Date(o.getTime()-90*24*60*60*1e3);break}n&&(s.start_date=n.toISOString().split("T")[0],s.end_date=o.toISOString().split("T")[0])}const e=await M.getExecutionStats(s);if(e.status==="success")return _.value=e.data,e.data;throw new Error(e.message||"获取执行统计失败")}catch(s){throw console.error("获取执行统计失败:",s),s}},A=async()=>{try{const s=await M.getWorkflowStats();if(s.status==="success")return b.value=s.data||[],s.data;throw new Error(s.message||"获取工作流统计失败")}catch(s){throw console.error("获取工作流统计失败:",s),s}},D=async()=>{x.value=!0,f.value=null;try{await Promise.all([z(),$(),A()]),g.success("统计数据已刷新")}catch(s){console.error("刷新统计数据失败:",s),f.value=s.message||"刷新统计数据失败",g.error("刷新统计数据失败："+(s.message||"未知错误"))}finally{x.value=!1}},I=()=>{g.info("导出功能开发中...")},j=s=>s>=1e6?(s/1e6).toFixed(1)+"M":s>=1e3?(s/1e3).toFixed(1)+"K":s.toString(),T=s=>Math.round(s*10)/10,B=s=>{if(!s)return"0秒";const e=Math.floor(s/1e3);if(e<60)return`${e}秒`;const o=Math.floor(e/60),n=e%60;return`${o}分${n}秒`},L=s=>({succeeded:"成功",failed:"失败",running:"运行中",pending:"等待中",cancelled:"已取消"})[s]||s,R=s=>({succeeded:"bg-green-500",failed:"bg-red-500",running:"bg-blue-500",pending:"bg-yellow-500",cancelled:"bg-gray-500"})[s]||"bg-gray-500",U=s=>({succeeded:"bg-green-500",failed:"bg-red-500",running:"bg-blue-500",pending:"bg-yellow-500",cancelled:"bg-gray-500"})[s]||"bg-gray-500",E=(s,e)=>{const o=Object.values(_.value.status_counts||{}).reduce((n,W)=>n+W,0);return o>0?Math.round(e/o*100):0},v=s=>({executions:12.5,points:8.2,success_rate:1.2,duration:5.3})[s]||0,V=()=>"text-red-600";return q(()=>{D()}),(s,e)=>(l(),d("div",rt,[t("div",lt,[e[5]||(e[5]=t("div",null,[t("h1",{class:"text-xl font-semibold text-gray-800"},"统计分析"),t("p",{class:"text-gray-600 mt-1"},"查看工作流执行统计和数据分析")],-1)),t("div",it,[t("button",{onClick:D,disabled:x.value,class:"text-gray-600 hover:text-gray-800 px-3 py-2 flex items-center transition-colors"},[i(r(F),{class:m([x.value?"animate-spin":"","w-5 h-5 mr-1"])},null,8,["class"]),e[3]||(e[3]=t("span",{class:"hidden md:inline"},"刷新",-1))],8,dt),t("button",{onClick:I,class:"text-gray-600 hover:text-gray-800 px-3 py-2 flex items-center transition-colors"},[i(r(Q),{class:"w-5 h-5 mr-1"}),e[4]||(e[4]=t("span",{class:"hidden md:inline"},"导出报告",-1))])])]),t("div",ct,[t("div",ut,[t("div",mt,[G(t("select",{"onUpdate:modelValue":e[0]||(e[0]=o=>u.value=o),onChange:$,class:"border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 bg-white"},e[6]||(e[6]=[t("option",{value:"7d"},"最近7天",-1),t("option",{value:"30d"},"最近30天",-1),t("option",{value:"90d"},"最近90天",-1),t("option",{value:"all"},"所有时间",-1)]),544),[[H,u.value]])])])]),x.value&&!h.value.total_workflows?(l(),d("div",gt,[i(r(F),{class:"w-8 h-8 animate-spin text-indigo-600 mr-3"}),e[7]||(e[7]=t("span",{class:"text-gray-600"},"正在加载统计数据...",-1))])):f.value?(l(),d("div",xt,[t("div",pt,[t("div",ht,[i(r(X),{class:"h-5 w-5 text-red-400"})]),t("div",_t,[e[8]||(e[8]=t("h3",{class:"text-sm font-medium text-red-800"},"加载失败",-1)),t("div",ft,[t("p",null,a(f.value),1)])])])])):(l(),d("div",vt,[t("div",yt,[t("div",wt,[t("div",bt,[i(r(Y),{class:"w-6 h-6 text-blue-600"})]),t("div",kt,[e[9]||(e[9]=t("h3",{class:"text-sm font-medium text-gray-500"},"工作流执行次数",-1)),t("div",St,[t("p",Mt,a(j(h.value.total_executions||0)),1),t("p",Ct,[i(r(w),{class:"w-4 h-4 mr-1"}),y(" "+a(v("executions"))+"% ",1)])])])])]),t("div",$t,[t("div",Dt,[t("div",jt,[i(r(nt),{class:"w-6 h-6 text-yellow-600"})]),t("div",Tt,[e[10]||(e[10]=t("h3",{class:"text-sm font-medium text-gray-500"},"资源点数消耗",-1)),t("div",Bt,[t("p",Et,a(j(O.value)),1),t("p",Vt,[i(r(w),{class:"w-4 h-4 mr-1"}),y(" "+a(v("points"))+"% ",1)])])])])]),t("div",Nt,[t("div",Pt,[t("div",Ft,[i(r(tt),{class:"w-6 h-6 text-green-600"})]),t("div",Ot,[e[11]||(e[11]=t("h3",{class:"text-sm font-medium text-gray-500"},"工作流成功率",-1)),t("div",zt,[t("p",At,a(T(h.value.success_rate||0))+"%",1),t("p",It,[i(r(w),{class:"w-4 h-4 mr-1"}),y(" "+a(v("success_rate"))+"% ",1)])])])])]),t("div",Lt,[t("div",Rt,[t("div",Ut,[i(r(et),{class:"w-6 h-6 text-indigo-600"})]),t("div",Wt,[e[12]||(e[12]=t("h3",{class:"text-sm font-medium text-gray-500"},"平均执行时间",-1)),t("div",Kt,[t("p",Zt,a(B(_.value.avg_duration||0)),1),t("p",{class:m(["ml-2 text-sm font-medium",V()])},[V().includes("green")?(l(),N(r(w),{key:0,class:"w-4 h-4 mr-1"})):(l(),N(r(at),{key:1,class:"w-4 h-4 mr-1"})),y(" "+a(v("duration"))+"% ",1)],2)])])])])])),t("div",qt,[t("div",Gt,[t("div",Ht,[e[13]||(e[13]=t("h3",{class:"text-lg font-medium text-gray-900"},"资源点数使用趋势",-1)),t("div",Jt,[t("button",{onClick:e[1]||(e[1]=o=>p.value="points"),class:m([p.value==="points"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700","px-3 py-1 rounded-lg text-sm font-medium transition-colors"])}," 点数消耗 ",2),t("button",{onClick:e[2]||(e[2]=o=>p.value="executions"),class:m([p.value==="executions"?"bg-indigo-100 text-indigo-700":"text-gray-500 hover:text-gray-700","px-3 py-1 rounded-lg text-sm font-medium transition-colors"])}," 执行次数 ",2)])]),t("div",Qt,[t("div",Xt,[i(r(st),{class:"w-12 h-12 mx-auto text-gray-400 mb-2"}),t("p",Yt,a(p.value==="points"?"点数消耗":"执行次数")+"趋势图",1),t("p",te," 过去"+a(u.value==="7d"?"7天":u.value==="30d"?"30天":u.value==="90d"?"90天":"所有时间"),1)])])]),t("div",ee,[e[14]||(e[14]=t("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"执行状态分布",-1)),t("div",se,[(l(!0),d(k,null,S(_.value.status_counts,(o,n)=>(l(),d("div",{key:n,class:"flex items-center justify-between"},[t("div",oe,[t("div",{class:m([R(n),"w-4 h-4 rounded-full mr-3"])},null,2),t("span",ae,a(L(n)),1)]),t("div",ne,[t("span",re,a(o),1),t("span",le," ("+a(E(n,o))+"%) ",1)])]))),128))]),t("div",ie,[t("div",de,[(l(!0),d(k,null,S(_.value.status_counts,(o,n)=>(l(),d("div",{key:n,style:P({width:E(n,o)+"%"}),class:m(U(n))},null,6))),128))])])])]),b.value.length>0?(l(),d("div",ce,[e[16]||(e[16]=t("div",{class:"px-6 py-4 border-b border-gray-200"},[t("h3",{class:"text-lg font-medium text-gray-900"},"工作流性能统计"),t("p",{class:"text-sm text-gray-500 mt-1"},"查看各个工作流的执行情况和成功率")],-1)),t("div",ue,[t("table",me,[e[15]||(e[15]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"工作流名称"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"总执行次数"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"成功次数"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"失败次数"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"成功率"),t("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"平均耗时")])],-1)),t("tbody",ge,[(l(!0),d(k,null,S(b.value,o=>(l(),d("tr",{key:o.workflow_id,class:"hover:bg-gray-50"},[t("td",xe,[t("div",pe,[i(r(ot),{class:"w-5 h-5 text-indigo-500 mr-2"}),t("div",he,a(o.workflow_name),1)])]),t("td",_e,a(o.total_runs),1),t("td",fe,a(o.success_runs),1),t("td",ve,a(o.failure_runs),1),t("td",ye,[t("div",we,[t("div",be,[t("div",{class:"bg-green-500 h-2 rounded-full",style:P({width:o.success_rate+"%"})},null,4)]),t("span",ke,a(T(o.success_rate))+"%",1)])]),t("td",Se,a(B(o.avg_duration_ms)),1)]))),128))])])])])):J("",!0)]))}};export{Ne as default};
