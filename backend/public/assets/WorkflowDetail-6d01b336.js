import{_ as j,I as T,C as E,D as L,g as m,v as b,h as R,c as o,a as t,t as a,j as g,e as N,d as U,n as w,x as F,y as h,z as S,A as H,o as d}from"./index-f19ebc4a.js";import{u as q}from"./workflow-efdfe936.js";const G={class:"py-6"},K={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},P={class:"flex items-center justify-between"},Q={class:"text-2xl font-semibold text-gray-900 dark:text-white"},X={class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},Y={class:"flex space-x-3"},Z=["disabled"],tt={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},et={key:0,class:"mt-6"},st={key:1,class:"mt-6 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4"},rt={class:"flex"},at={class:"ml-3"},ot={class:"mt-2 text-sm text-red-700 dark:text-red-300"},dt={key:2,class:"mt-6"},it={key:0,class:"bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg"},lt={class:"border-t border-gray-200 dark:border-gray-700 px-4 py-5 sm:p-0"},nt={class:"sm:divide-y sm:divide-gray-200 dark:sm:divide-gray-700"},mt={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},ut={class:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2"},gt={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},ct={class:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2"},xt={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},yt={class:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2"},vt={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},ft={class:"mt-1 text-sm sm:mt-0 sm:col-span-2"},pt={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},kt={class:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2"},bt={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},wt={class:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2"},ht={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},_t={class:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2"},Ct={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},Nt={class:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2"},St={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},Ot={class:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2"},Dt={key:0,class:"mt-1 text-xs text-gray-500 dark:text-gray-400"},Jt={class:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6"},Mt={class:"mt-1 text-sm text-gray-900 dark:text-white sm:mt-0 sm:col-span-2"},Wt={class:"bg-gray-50 dark:bg-gray-900 p-4 rounded-md overflow-auto max-h-96"},$t={class:"text-xs font-mono"},Vt={key:1,class:"bg-white dark:bg-gray-800 shadow overflow-hidden sm:rounded-lg"},zt={class:"grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6"},At={class:"sm:col-span-4"},Bt={class:"mt-1"},It={key:0,class:"mt-2 text-sm text-red-600"},jt={class:"sm:col-span-6"},Tt={class:"mt-1"},Et={key:0,class:"mt-2 text-sm text-red-600"},Lt={class:"sm:col-span-3"},Rt={class:"mt-1"},Ut={class:"sm:col-span-6 border-t border-gray-200 dark:border-gray-700 pt-5 mt-4"},Ft={class:"mt-4"},Ht={class:"mt-1"},qt={key:0,class:"mt-2 text-sm text-red-600"},Gt={class:"pt-5 mt-6 border-t border-gray-200 dark:border-gray-700"},Kt={class:"flex justify-end"},Pt=["disabled"],Qt={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Xt={__name:"WorkflowDetail",setup(Yt){const D=T(),J=E(),y=L(),_=q(),r=m({}),l=m({}),c=m(""),u=m(!0),f=m(null),v=m(!1),p=m(!1),k=m(!1),i=m({}),O=async()=>{const s=parseInt(D.params.id);if(!s){f.value="无效的工作流ID",u.value=!1;return}u.value=!0,f.value=null;try{const e=await _.fetchWorkflowById(s);r.value=e,l.value={...e},c.value=JSON.stringify(e.definition,null,2)}catch(e){f.value=e.message||"加载工作流失败",console.error("获取工作流详情失败:",e)}finally{u.value=!1}},M=()=>{try{const s=JSON.parse(c.value);c.value=JSON.stringify(s,null,2),i.value.definition=""}catch(s){i.value.definition=`JSON格式错误: ${s.message}`}},W=()=>{var e;const s={};(e=l.value.name)!=null&&e.trim()||(s.name="工作流名称不能为空");try{JSON.parse(c.value)}catch(x){s.definition=`JSON格式错误: ${x.message}`}return i.value=s,Object.keys(s).length===0},$=async()=>{if(!W()){y.error("请修正表单中的错误");return}p.value=!0;try{const s={name:l.value.name,description:l.value.description,status:l.value.status,definition:JSON.parse(c.value)},e=await _.updateWorkflow(r.value.id,s);r.value=e,y.success("工作流更新成功"),v.value=!1}catch(s){if(console.error("更新工作流失败",s),s.response&&s.response.status===400){const e=s.response.data.errors||{};Object.keys(e).forEach(x=>{i.value[x]=e[x]}),y.error("表单验证失败，请检查输入")}else y.error("更新工作流失败: "+(s.message||"未知错误"))}finally{p.value=!1}},V=async()=>{k.value=!0;try{const s=await _.executeWorkflow(r.value.id);y.success("工作流执行已启动"),J.push(`/executions/${s.id}`)}catch(s){y.error("执行工作流失败: "+(s.message||"未知错误"))}finally{k.value=!1}},C=s=>{if(!s)return"";const e=new Date(s);return new Intl.DateTimeFormat("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).format(e)},z=b(()=>({draft:"草稿",active:"活跃",inactive:"暂停",archived:"归档"})[r.value.status]||r.value.status),A=b(()=>{const s="px-2 inline-flex text-xs leading-5 font-semibold rounded-full";switch(r.value.status){case"active":return`${s} bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-300`;case"inactive":return`${s} bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-300`;case"draft":return`${s} bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300`;case"archived":return`${s} bg-red-100 dark:bg-red-900/30 text-red-800 dark:text-red-300`;default:return`${s} bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300`}}),B=b(()=>({manual:"手动触发",schedule:"定时计划",webhook:"Webhook",event:"事件触发"})[r.value.trigger_type]||"未知"),I=b(()=>{if(!r.value.definition)return"";try{return typeof r.value.definition=="string"?JSON.stringify(JSON.parse(r.value.definition),null,2):JSON.stringify(r.value.definition,null,2)}catch{return String(r.value.definition)}});return R(()=>{O()}),(s,e)=>{var x;return d(),o("div",G,[t("div",K,[t("div",P,[t("div",null,[t("h1",Q,a(u.value?"加载中...":r.value.name),1),t("p",X,a(u.value?"":r.value.description),1)]),t("div",Y,[t("button",{onClick:e[0]||(e[0]=n=>s.$router.push("/workflows")),class:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-200 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 返回 "),!u.value&&r.value.id?(d(),o("button",{key:0,onClick:V,disabled:k.value,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},[k.value?(d(),o("svg",tt,e[7]||(e[7]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):g("",!0),N(" "+a(k.value?"执行中...":"执行工作流"),1)],8,Z)):g("",!0),!u.value&&r.value.id?(d(),o("button",{key:1,onClick:e[1]||(e[1]=n=>v.value=!v.value),class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"},a(v.value?"取消编辑":"编辑工作流"),1)):g("",!0)])]),u.value?(d(),o("div",et,e[8]||(e[8]=[U('<div class="animate-pulse flex space-x-4" data-v-6f643019><div class="flex-1 space-y-4 py-1" data-v-6f643019><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4" data-v-6f643019></div><div class="space-y-2" data-v-6f643019><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded" data-v-6f643019></div><div class="h-4 bg-gray-200 dark:bg-gray-700 rounded w-5/6" data-v-6f643019></div></div></div></div>',1)]))):f.value?(d(),o("div",st,[t("div",rt,[e[10]||(e[10]=t("div",{class:"flex-shrink-0"},[t("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),t("div",at,[e[9]||(e[9]=t("h3",{class:"text-sm font-medium text-red-800 dark:text-red-200"},"加载工作流失败",-1)),t("div",ot,[t("p",null,a(f.value),1)]),t("div",{class:"mt-4"},[t("button",{onClick:O,class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-red-700 dark:text-red-300 bg-red-50 dark:bg-red-900/30 hover:bg-red-100 dark:hover:bg-red-900/50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," 重试 ")])])])])):(d(),o("div",dt,[v.value?(d(),o("div",Vt,[t("form",{onSubmit:F($,["prevent"]),class:"p-6"},[t("div",zt,[t("div",At,[e[22]||(e[22]=t("label",{for:"name",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 工作流名称 ",-1)),t("div",Bt,[h(t("input",{type:"text",id:"name","onUpdate:modelValue":e[2]||(e[2]=n=>l.value.name=n),class:w([{"border-red-300 focus:ring-red-500 focus:border-red-500":i.value.name},"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"]),placeholder:"输入工作流名称"},null,2),[[S,l.value.name]]),i.value.name?(d(),o("p",It,a(i.value.name),1)):g("",!0)])]),t("div",jt,[e[23]||(e[23]=t("label",{for:"description",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 描述 ",-1)),t("div",Tt,[h(t("textarea",{id:"description","onUpdate:modelValue":e[3]||(e[3]=n=>l.value.description=n),rows:"3",class:w([{"border-red-300 focus:ring-red-500 focus:border-red-500":i.value.description},"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"]),placeholder:"描述此工作流的用途和功能"},null,2),[[S,l.value.description]]),i.value.description?(d(),o("p",Et,a(i.value.description),1)):g("",!0)])]),t("div",Lt,[e[25]||(e[25]=t("label",{for:"status",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," 状态 ",-1)),t("div",Rt,[h(t("select",{id:"status","onUpdate:modelValue":e[4]||(e[4]=n=>l.value.status=n),class:"shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"},e[24]||(e[24]=[t("option",{value:"draft"},"草稿",-1),t("option",{value:"active"},"活跃",-1),t("option",{value:"inactive"},"暂停",-1),t("option",{value:"archived"},"归档",-1)]),512),[[H,l.value.status]])])]),t("div",Ut,[e[27]||(e[27]=t("h3",{class:"text-lg leading-6 font-medium text-gray-900 dark:text-white"},"工作流定义",-1)),e[28]||(e[28]=t("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"},"使用JSON格式定义工作流的步骤和逻辑",-1)),t("div",Ft,[e[26]||(e[26]=t("label",{for:"definition",class:"block text-sm font-medium text-gray-700 dark:text-gray-300"}," JSON 定义 ",-1)),t("div",Ht,[h(t("textarea",{id:"definition","onUpdate:modelValue":e[5]||(e[5]=n=>c.value=n),rows:"10",class:w([{"border-red-300 focus:ring-red-500 focus:border-red-500":i.value.definition},"font-mono shadow-sm focus:ring-primary-500 focus:border-primary-500 block w-full sm:text-sm border-gray-300 dark:border-gray-600 dark:bg-gray-700 dark:text-white rounded-md"]),placeholder:'{"steps": []}'},null,2),[[S,c.value]]),i.value.definition?(d(),o("p",qt,a(i.value.definition),1)):g("",!0)])]),t("div",{class:"mt-4 flex justify-end"},[t("button",{type:"button",onClick:M,class:"inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 格式化 JSON ")])])]),t("div",Gt,[t("div",Kt,[t("button",{type:"button",onClick:e[6]||(e[6]=n=>v.value=!1),class:"bg-white dark:bg-gray-800 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"}," 取消 "),t("button",{type:"submit",disabled:p.value,class:"ml-3 inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},[p.value?(d(),o("svg",Qt,e[29]||(e[29]=[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):g("",!0),N(" "+a(p.value?"保存中...":"保存工作流"),1)],8,Pt)])])],32)])):(d(),o("div",it,[e[21]||(e[21]=t("div",{class:"px-4 py-5 sm:px-6"},[t("h3",{class:"text-lg leading-6 font-medium text-gray-900 dark:text-white"},"工作流详情"),t("p",{class:"mt-1 max-w-2xl text-sm text-gray-500 dark:text-gray-400"},"工作流配置和定义")],-1)),t("div",lt,[t("dl",nt,[t("div",mt,[e[11]||(e[11]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"ID",-1)),t("dd",ut,a(r.value.id),1)]),t("div",gt,[e[12]||(e[12]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"名称",-1)),t("dd",ct,a(r.value.name),1)]),t("div",xt,[e[13]||(e[13]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"描述",-1)),t("dd",yt,a(r.value.description||"无描述"),1)]),t("div",vt,[e[14]||(e[14]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"状态",-1)),t("dd",ft,[t("span",{class:w(A.value)},a(z.value),3)])]),t("div",pt,[e[15]||(e[15]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"创建时间",-1)),t("dd",kt,a(C(r.value.createdAt)),1)]),t("div",bt,[e[16]||(e[16]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"更新时间",-1)),t("dd",wt,a(C(r.value.updatedAt)),1)]),t("div",ht,[e[17]||(e[17]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"最后执行时间",-1)),t("dd",_t,a(r.value.lastRunAt?C(r.value.lastRunAt):"从未执行"),1)]),t("div",Ct,[e[18]||(e[18]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"执行次数",-1)),t("dd",Nt,a(r.value.runCount),1)]),t("div",St,[e[19]||(e[19]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"触发方式",-1)),t("dd",Ot,[N(a(B.value)+" ",1),r.value.trigger_type==="schedule"?(d(),o("div",Dt," Cron表达式: "+a(((x=r.value.trigger_config)==null?void 0:x.cron)||"N/A"),1)):g("",!0)])]),t("div",Jt,[e[20]||(e[20]=t("dt",{class:"text-sm font-medium text-gray-500 dark:text-gray-400"},"工作流定义",-1)),t("dd",Mt,[t("div",Wt,[t("pre",$t,a(I.value),1)])])])])])]))]))])])}}},ee=j(Xt,[["__scopeId","data-v-6f643019"]]);export{ee as default};
