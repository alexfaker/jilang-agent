import{J as n,p as r}from"./index-f19ebc4a.js";const o=n("execution",{state:()=>({executions:[],currentExecution:null,loading:!1,error:null,pagination:{page:1,limit:10,total:0},filters:{workflowId:null,status:"",startDate:"",endDate:""}}),getters:{getExecutionById:t=>e=>t.executions.find(i=>i.id===e)||null,filteredExecutions:t=>{let e=[...t.executions];if(t.filters.workflowId&&(e=e.filter(i=>i.workflowId===t.filters.workflowId)),t.filters.status&&(e=e.filter(i=>i.status===t.filters.status)),t.filters.startDate){const i=new Date(t.filters.startDate);e=e.filter(s=>new Date(s.startedAt)>=i)}if(t.filters.endDate){const i=new Date(t.filters.endDate);i.setHours(23,59,59,999),e=e.filter(s=>new Date(s.startedAt)<=i)}return e},totalPages:t=>Math.ceil(t.pagination.total/t.pagination.limit)||1,isFiltered:t=>!!t.filters.workflowId||!!t.filters.status||!!t.filters.startDate||!!t.filters.endDate},actions:{async fetchExecutions(t={}){this.loading=!0,this.error=null;try{const e={limit:this.pagination.limit,offset:(this.pagination.page-1)*this.pagination.limit,workflow_id:this.filters.workflowId,status:this.filters.status,start_date:this.filters.startDate,end_date:this.filters.endDate,...t},i=await r.getExecutions(e);return this.executions=i.data||[],this.pagination.total=i.total||0,i}catch(e){throw console.error("获取执行历史失败:",e),this.error=e.message||"获取执行历史失败",e}finally{this.loading=!1}},async fetchExecutionById(t){this.loading=!0,this.error=null;try{const e=await r.getExecution(t);this.currentExecution=e;const i=this.executions.findIndex(s=>s.id===t);return i!==-1&&(this.executions[i]=e),e}catch(e){throw console.error(`获取执行记录 #${t} 失败:`,e),this.error=e.message||"获取执行记录详情失败",e}finally{this.loading=!1}},async cancelExecution(t){this.loading=!0,this.error=null;try{await r.cancelExecution(t);const e=this.executions.findIndex(i=>i.id===t);e!==-1&&(this.executions[e]={...this.executions[e],status:"cancelled",statusText:"已取消",statusClass:"warning"}),this.currentExecution&&this.currentExecution.id===t&&(this.currentExecution={...this.currentExecution,status:"cancelled",statusText:"已取消",statusClass:"warning"})}catch(e){throw console.error(`取消执行 #${t} 失败:`,e),this.error=e.message||"取消执行失败",e}finally{this.loading=!1}},setPage(t){t>=1&&t<=this.totalPages&&(this.pagination.page=t,this.fetchExecutions())},setLimit(t){this.pagination.limit=t,this.pagination.page=1,this.fetchExecutions()},setFilter(t){this.filters={...this.filters,...t},this.pagination.page=1,this.fetchExecutions()},clearFilters(){this.filters={workflowId:null,status:"",startDate:"",endDate:""},this.pagination.page=1,this.fetchExecutions()},formatStatus(t){return{pending:{text:"等待中",class:"info"},running:{text:"运行中",class:"info"},success:{text:"成功",class:"success"},failed:{text:"失败",class:"error"},cancelled:{text:"已取消",class:"warning"}}[t]||{text:t,class:"default"}},formatDateTime(t){return t?new Date(t).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):""},formatDuration(t){if(!t)return"0秒";if(t<60)return`${t}秒`;if(t<3600){const e=Math.floor(t/60),i=t%60;return`${e}分${i>0?i+"秒":""}`}else{const e=Math.floor(t/3600),i=Math.floor(t%3600/60);return`${e}小时${i>0?i+"分":""}`}}}});export{o as u};
