import{o as r,c as m,a as e,_ as X,f as Y,g as p,h as Z,b as l,u as n,t as c,n as M,e as g,w as W,F,i as L,j as V,k as j,r as ee,l as u,s as te,m as q,p as se}from"./index-f19ebc4a.js";import{r as S}from"./ArrowPathIcon-48974b59.js";import{r as z}from"./RectangleGroupIcon-67d3093d.js";import{r as C,a as oe}from"./PlayCircleIcon-099ac575.js";import{r as H}from"./CpuChipIcon-576f530e.js";import{r as ne}from"./ClockIcon-cbcc2b6e.js";import{r as T,a as re}from"./PlusIcon-58fe7323.js";import{r as ae}from"./ExclamationTriangleIcon-acab16c9.js";import{r as le,a as ie}from"./DocumentTextIcon-9f863586.js";import{r as de}from"./MagnifyingGlassIcon-e9ac7f42.js";function ce(N,D){return r(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function I(N,D){return r(),m("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4.5 12a7.5 7.5 0 0 0 15 0m-15 0a7.5 7.5 0 1 1 15 0m-15 0H3m16.5 0H21m-1.5 0H12m-8.457 3.077 1.41-.513m14.095-5.13 1.41-.513M5.106 17.785l1.15-.964m11.49-9.642 1.149-.964M7.501 19.795l.75-1.3m7.5-12.99.75-1.3m-6.063 16.658.26-1.477m2.605-14.772.26-1.477m0 17.726-.26-1.477M10.698 4.614l-.26-1.477M16.5 19.794l-.75-1.299M7.5 4.205 12 12m6.894 5.785-1.149-.964M6.256 7.178l-1.15-.964m15.352 8.864-1.41-.513M4.954 9.435l-1.41-.514M12.002 12l-3.75 6.495"})])}const ue={class:"p-6"},me={key:0,class:"flex items-center justify-center py-12"},xe={class:"flex items-center space-x-3"},fe={key:1},ge={class:"mb-8 flex items-center justify-between"},pe={class:"text-2xl font-bold text-gray-800"},we=["disabled"],_e={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8"},he={class:"card bg-white p-6 rounded-2xl shadow-lg"},ye={class:"flex items-center justify-between mb-4"},ve={class:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center"},be={class:"flex items-end justify-between"},ke={class:"text-2xl font-bold text-gray-800"},je={class:"text-green-500 text-sm font-medium flex items-center"},Ce={class:"card bg-white p-6 rounded-2xl shadow-lg"},De={class:"flex items-center justify-between mb-4"},$e={class:"w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center"},Ee={class:"flex items-end justify-between"},Me={class:"text-2xl font-bold text-gray-800"},We={class:"text-green-500 text-sm font-medium flex items-center"},Se={class:"card bg-white p-6 rounded-2xl shadow-lg"},Ne={class:"flex items-center justify-between mb-4"},Ae={class:"w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center"},Be={class:"flex items-end justify-between"},Re={class:"text-2xl font-bold text-gray-800"},Fe={class:"text-green-500 text-sm font-medium flex items-center"},Le={class:"card bg-white p-6 rounded-2xl shadow-lg"},Ve={class:"flex items-center justify-between mb-4"},qe={class:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center"},ze={class:"flex items-end justify-between"},He={class:"text-2xl font-bold text-gray-800"},Te={class:"text-green-500 text-sm font-medium flex items-center"},Ie={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Pe={class:"card bg-white p-6 rounded-2xl shadow-lg"},Ue={class:"flex items-center justify-between mb-6"},Ge={class:"space-y-4"},Je={class:"flex-1"},Ke={class:"text-sm font-medium text-gray-800"},Oe={class:"text-xs text-gray-500"},Qe={key:0,class:"text-center py-8 text-gray-500"},Xe={class:"card bg-white p-6 rounded-2xl shadow-lg"},Ye={class:"flex items-center justify-between mb-6"},Ze={class:"space-y-4"},et={class:"flex items-center"},tt={class:"text-sm font-medium text-gray-800"},st={class:"text-xs text-gray-500"},ot=["onClick","disabled"],nt={key:0,class:"text-center py-8 text-gray-500"},rt={__name:"Dashboard",setup(N){var R;const D=Y(),$=p(!0),w=p(!1),P=p(((R=D.user)==null?void 0:R.username)||"用户"),f=p({workflows:0,executions:0,activeWorkflows:0,timeSaved:0}),h=p([]),y=p([]),_=p([]),U=async()=>{try{const o=await te.getDashboardStats();if(o.status==="success"){const t=o.data;f.value.workflows=t.total_workflows||0,f.value.executions=t.total_executions||0;const a=t.recent_executions||[],s=new Set(a.map(x=>x.workflow_id));return f.value.activeWorkflows=s.size,f.value.timeSaved=Math.round((t.total_executions||0)*.5*10)/10,t}}catch(o){return console.error("获取仪表盘统计失败:",o),j.error("获取统计数据失败"),null}},G=async o=>{try{const a=((o==null?void 0:o.recent_executions)||[]).map(s=>{var x;return{id:s.id,type:s.status==="succeeded"?"complete":s.status==="failed"?"failed":"execute",title:s.status==="succeeded"?"完成了工作流":s.status==="failed"?"工作流执行失败":"执行了工作流",workflowName:((x=s.workflow)==null?void 0:x.name)||"未知工作流",workflowId:s.workflow_id,timestamp:new Date(s.created_at)}});h.value=a}catch(t){console.error("处理最近活动失败:",t),h.value=[]}},J=async()=>{var o;try{const t=await q.getWorkflows({limit:50});if(t.status!=="success")throw new Error("获取工作流列表失败");const a=t.data.workflows||[],x=((o=(await se.getExecutions({page:1,page_size:100})).data)==null?void 0:o.executions)||[],v=a.map(i=>{const d=x.filter(E=>E.workflow_id===i.id),k=d.length>0?new Date(Math.max(...d.map(E=>new Date(E.created_at)))):new Date(i.created_at);return{id:i.id,name:i.name,category:K(i),lastExecuted:k,executionCount:d.length}}),b=v.filter(i=>i.executionCount>0).sort((i,d)=>d.executionCount!==i.executionCount?d.executionCount-i.executionCount:new Date(d.lastExecuted)-new Date(i.lastExecuted)).slice(0,4);if(b.length<4){const i=v.filter(d=>!b.find(k=>k.id===d.id)).sort((d,k)=>new Date(k.lastExecuted)-new Date(d.lastExecuted)).slice(0,4-b.length);b.push(...i)}y.value=b}catch(t){console.error("获取常用工作流失败:",t),y.value=[]}},K=o=>{const t=(o.name||"").toLowerCase(),a=(o.description||"").toLowerCase(),s=t+" "+a;return s.includes("数据")||s.includes("处理")||s.includes("分析")?"data":s.includes("客服")||s.includes("支持")||s.includes("回复")?"support":s.includes("内容")||s.includes("文本")||s.includes("审核")?"content":"analysis"},A=async()=>{$.value=!0;try{const o=await U();await Promise.all([G(o),J()])}catch(o){console.error("加载仪表盘数据失败:",o),j.error("加载数据失败，请刷新页面重试")}finally{$.value=!1}},O=async()=>{if(!w.value){w.value=!0;try{await A(),j.success("数据已刷新")}finally{w.value=!1}}},B=o=>{const a=new Date-o,s=Math.floor(a/(1e3*60)),x=Math.floor(a/(1e3*60*60)),v=Math.floor(a/(1e3*60*60*24));return s<60?`${s}分钟前`:x<24?`${x}小时前`:v===1?"昨天":`${v}天前`},Q=async o=>{if(!_.value.includes(o)){_.value.push(o);try{const t=await q.executeWorkflow(o,{});if(t.status==="success"){j.success("工作流已开始执行");const a=y.value.find(s=>s.id===o);a&&(h.value.unshift({id:Date.now(),type:"execute",title:"执行了工作流",workflowName:a.name,workflowId:o,timestamp:new Date}),a.lastExecuted=new Date),f.value.executions++}else throw new Error(t.message||"执行失败")}catch(t){console.error("执行工作流失败:",t),j.error("执行工作流失败: "+(t.message||"未知错误"))}finally{_.value=_.value.filter(t=>t!==o)}}};return Z(()=>{A()}),(o,t)=>{const a=ee("router-link");return r(),m("div",ue,[$.value?(r(),m("div",me,[e("div",xe,[l(n(S),{class:"w-6 h-6 animate-spin text-indigo-600"}),t[0]||(t[0]=e("span",{class:"text-lg text-gray-600"},"加载中...",-1))])])):(r(),m("div",fe,[e("div",ge,[e("div",null,[e("h2",pe,"欢迎回来，"+c(P.value),1),t[1]||(t[1]=e("p",{class:"text-gray-600"},"这是您的AI工作流平台使用概览",-1))]),e("button",{onClick:O,disabled:w.value,class:"flex items-center space-x-2 px-4 py-2 text-sm font-medium text-gray-600 hover:text-indigo-600 hover:bg-gray-50 rounded-lg transition-colors"},[l(n(S),{class:M(["w-4 h-4",w.value?"animate-spin":""])},null,8,["class"]),e("span",null,c(w.value?"刷新中...":"刷新数据"),1)],8,we)]),e("div",_e,[e("div",he,[e("div",ye,[e("div",ve,[l(n(z),{class:"text-blue-600 w-6 h-6"})]),t[2]||(t[2]=e("span",{class:"text-sm font-medium text-gray-500"},"工作流",-1))]),e("div",be,[e("div",null,[e("p",ke,c(f.value.workflows),1),t[3]||(t[3]=e("p",{class:"text-sm text-gray-500"},"创建的工作流",-1))]),e("span",je,[l(n(C),{class:"w-4 h-4 mr-1"}),t[4]||(t[4]=g(" 8.2% "))])])]),e("div",Ce,[e("div",De,[e("div",$e,[l(n(oe),{class:"text-purple-600 w-6 h-6"})]),t[5]||(t[5]=e("span",{class:"text-sm font-medium text-gray-500"},"执行",-1))]),e("div",Ee,[e("div",null,[e("p",Me,c(f.value.executions),1),t[6]||(t[6]=e("p",{class:"text-sm text-gray-500"},"总执行次数",-1))]),e("span",We,[l(n(C),{class:"w-4 h-4 mr-1"}),t[7]||(t[7]=g(" 12.4% "))])])]),e("div",Se,[e("div",Ne,[e("div",Ae,[l(n(H),{class:"text-amber-600 w-6 h-6"})]),t[8]||(t[8]=e("span",{class:"text-sm font-medium text-gray-500"},"活跃",-1))]),e("div",Be,[e("div",null,[e("p",Re,c(f.value.activeWorkflows),1),t[9]||(t[9]=e("p",{class:"text-sm text-gray-500"},"活跃工作流",-1))]),e("span",Fe,[l(n(C),{class:"w-4 h-4 mr-1"}),t[10]||(t[10]=g(" 4.1% "))])])]),e("div",Le,[e("div",Ve,[e("div",qe,[l(n(ne),{class:"text-green-600 w-6 h-6"})]),t[11]||(t[11]=e("span",{class:"text-sm font-medium text-gray-500"},"节省",-1))]),e("div",ze,[e("div",null,[e("p",He,c(f.value.timeSaved),1),t[12]||(t[12]=e("p",{class:"text-sm text-gray-500"},"节省小时（估计）",-1))]),e("span",Te,[l(n(C),{class:"w-4 h-4 mr-1"}),t[13]||(t[13]=g(" 15.3% "))])])])]),e("div",Ie,[e("div",Pe,[e("div",Ue,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold text-gray-800"},"最近活动",-1)),l(a,{to:"/executions",class:"text-sm text-indigo-600 hover:text-indigo-800"},{default:W(()=>t[14]||(t[14]=[g("查看全部")])),_:1,__:[14]})]),e("div",Ge,[(r(!0),m(F,null,L(h.value,s=>(r(),m("div",{key:s.id,class:"flex items-start"},[e("div",{class:M(["w-10 h-10 rounded-full flex items-center justify-center mr-4 flex-shrink-0",s.type==="execute"?"bg-blue-100":s.type==="complete"?"bg-green-100":s.type==="create"?"bg-purple-100":s.type==="failed"?"bg-red-100":"bg-amber-100"])},[s.type==="execute"?(r(),u(n(T),{key:0,class:"w-5 h-5 text-blue-600"})):s.type==="complete"?(r(),u(n(ce),{key:1,class:"w-5 h-5 text-green-600"})):s.type==="create"?(r(),u(n(re),{key:2,class:"w-5 h-5 text-purple-600"})):s.type==="failed"?(r(),u(n(ae),{key:3,class:"w-5 h-5 text-red-600"})):(r(),u(n(I),{key:4,class:"w-5 h-5 text-amber-600"}))],2),e("div",Je,[e("p",Ke,[g(c(s.title)+" ",1),l(a,{to:`/workflows/${s.workflowId}`,class:"text-indigo-600 hover:text-indigo-800"},{default:W(()=>[g(c(s.workflowName),1)]),_:2},1032,["to"])]),e("p",Oe,c(B(s.timestamp)),1)])]))),128)),h.value.length===0?(r(),m("div",Qe,[l(n(I),{class:"w-12 h-12 mx-auto mb-3 text-gray-300"}),t[16]||(t[16]=e("p",null,"暂无最近活动",-1))])):V("",!0)])]),e("div",Xe,[e("div",Ye,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-gray-800"},"常用工作流",-1)),l(a,{to:"/workflows",class:"text-sm text-indigo-600 hover:text-indigo-800"},{default:W(()=>t[17]||(t[17]=[g("查看全部")])),_:1,__:[17]})]),e("div",Ze,[(r(!0),m(F,null,L(y.value,s=>(r(),m("div",{key:s.id,class:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors"},[e("div",et,[e("div",{class:M(["w-10 h-10 rounded-full flex items-center justify-center mr-4",s.category==="data"?"bg-blue-100":s.category==="support"?"bg-purple-100":s.category==="content"?"bg-green-100":"bg-amber-100"])},[s.category==="data"?(r(),u(n(H),{key:0,class:"w-5 h-5 text-blue-600"})):s.category==="support"?(r(),u(n(le),{key:1,class:"w-5 h-5 text-purple-600"})):s.category==="content"?(r(),u(n(ie),{key:2,class:"w-5 h-5 text-green-600"})):(r(),u(n(de),{key:3,class:"w-5 h-5 text-amber-600"}))],2),e("div",null,[e("p",tt,c(s.name),1),e("p",st,"上次执行: "+c(B(s.lastExecuted)),1)])]),e("button",{onClick:x=>Q(s.id),class:"text-gray-600 hover:text-indigo-600 transition-colors",disabled:_.value.includes(s.id)},[_.value.includes(s.id)?(r(),u(n(S),{key:1,class:"w-5 h-5 animate-spin"})):(r(),u(n(T),{key:0,class:"w-5 h-5"}))],8,ot)]))),128)),y.value.length===0?(r(),m("div",nt,[l(n(z),{class:"w-12 h-12 mx-auto mb-3 text-gray-300"}),t[19]||(t[19]=e("p",null,"暂无工作流",-1))])):V("",!0)])])])]))])}}},pt=X(rt,[["__scopeId","data-v-5e11fb8f"]]);export{pt as default};
